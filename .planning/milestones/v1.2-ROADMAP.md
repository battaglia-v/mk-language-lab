# Milestone v1.2: Infrastructure & CI Overhaul

**Status:** SHIPPED 2026-01-09
**Phases:** 17-20 (including 18.1 inserted)
**Total Plans:** 7

## Overview

Improve CI pipeline reliability and evaluate Cloudflare as an alternative hosting platform. The milestone delivered comprehensive CI auditing and caching optimizations while concluding that Cloudflare migration should be deferred until Next.js 16 support is added. Phase 18.1 was inserted to address remaining audit findings from v1.1.

## Phases

### Phase 17: CI Pipeline Audit

**Goal**: Review current GitHub Actions workflows, document gaps, benchmark build times
**Depends on**: v1.1 complete
**Plans**: 1 plan

Plans:
- [x] 17-01: Comprehensive CI audit report (7 workflows, gap analysis, benchmarks) — completed 2026-01-09

**Details:**
- Documented all 7 GitHub Actions workflows with triggers, jobs, dependencies, and secret requirements
- Analyzed gap against v1.2 success criteria — all CI gates already exist in ci.yml
- Benchmarked local build times: lint 37s, type-check 12s, build 29s, tests 13s
- Identified critical path: build → e2e → ci-success (~10-12 min total)
- Key finding: All v1.2 CI gate criteria already met; focus shifted to optimization

### Phase 18: CI Pipeline Improvements

**Goal**: Add type-check, lint, test gates; optimize build speed
**Depends on**: Phase 17
**Plans**: 1 plan

Plans:
- [x] 18-01: CI pipeline caching optimizations (Next.js build cache, Playwright browser cache) — completed 2026-01-09

**Details:**
- Added Next.js build cache to ci.yml build job (saves webpack recompilation)
- Added Playwright browser cache to e2e job with conditional install step
- Expected CI time reduction: ~2-3 minutes per run

### Phase 18.1: Lesson Quality Audit (INSERTED)

**Goal**: Address remaining audit findings: A2/B1 vocab translations, dark mode compliance, exercise variety, content completeness
**Depends on**: Phase 18
**Plans**: 4 plans

Plans:
- [x] 18.1-01: A2/B1 vocabulary corrections (same approach as A1) — completed 2026-01-09
- [x] 18.1-02: Dark mode deep audit (comprehensive color scan and fix) — completed 2026-01-09
- [x] 18.1-03: Exercise variety (add matching, word_order types) — completed 2026-01-09
- [x] 18.1-04: Content completeness verification (audit and fill gaps) — completed 2026-01-09

**Details:**
- Applied 476 vocabulary corrections across A2 (217) and B1 (259)
- Fixed dark mode compliance from ~40% to ~95% (15 components)
- Added 2 new exercise types: matching (tap-to-pair) and word_order (tap-to-arrange)
- Content audit verified all 40 lessons meet minimum requirements

### Phase 19: Cloudflare Research & PoC

**Goal**: Evaluate Cloudflare Pages/Workers, test migration feasibility with this Next.js app
**Depends on**: Phase 18
**Plans**: 1 plan

Plans:
- [x] 19-01: Cloudflare evaluation (compatibility, cost, recommendation) — completed 2026-01-09 — **NO-GO**

**Details:**
- Researched OpenNext Cloudflare adapter (`@opennextjs/cloudflare` v1.14.8)
- Critical blocker: Next.js 16 not supported (only v14-15 documented)
- Cost comparison: Vercel Pro (~$24/mo) vs Cloudflare Workers ($5/mo) = ~$19/month savings
- ROI calculation: 13+ year payback period at current scale
- Decision: NO-GO (DEFER) until OpenNext adds Next.js 16 support

### Phase 20: Migration Decision

**Goal**: Document findings, make go/no-go decision, create migration plan if proceeding
**Depends on**: Phase 19
**Plans**: 0 (skipped — NO-GO decision in Phase 19)

**Status:** SKIPPED — Cloudflare migration deferred per Phase 19 recommendation.

---

## Milestone Summary

**Decimal Phases:**
- Phase 18.1: Lesson Quality Audit (inserted after Phase 18 for audit findings)

**Key Decisions:**
- All v1.2 CI gate criteria already met by existing ci.yml (Phase 17)
- NO-GO on Cloudflare migration - Next.js 16 not supported by OpenNext adapter
- ~$19/month savings insufficient to justify 40+ hour migration effort
- Tap-to-select UX over drag-drop for better mobile compatibility (Phase 18.1-03)
- Dynamic lesson lookup pattern for maintainable seed files (Phase 18.1-04)

**Issues Resolved:**
- A2/B1 vocabulary had same auto-generated translation errors as A1 (names as words)
- Dark mode compliance only 40% - fixed to ~95%
- Exercise variety limited to 3 types - expanded to 5 types
- B1 Lesson 1 missing dialogue and exercises - content added

**Issues Deferred:**
- Cloudflare migration deferred until Next.js 16 support added to OpenNext
- Re-evaluate when traffic scales 10x (>5M requests/month) or Vercel costs exceed $100/month

**Technical Debt Incurred:**
- None - all planned work completed

---

_For current project status, see .planning/ROADMAP.md_

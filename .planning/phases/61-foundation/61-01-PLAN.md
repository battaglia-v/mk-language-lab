---
phase: 61-foundation
plan: 01
type: execute
---

<objective>
Set up the Expo project with managed workflow and configure for Play Store continuity.

Purpose: Establish the mobile app foundation with correct package ID to preserve Play Store listing.
Output: Buildable Expo project in `apps/mobile/` with EAS configuration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@plan.md

# Reference: Old Expo config (for patterns, NOT for restoration)
# git show 3de43ba0b87c000313041fbd49e959623f9c5768^:apps/mobile/app.config.ts

**Key decisions:**
- Package ID: `com.mklanguage.app` (preserve Play Store)
- Expo workflow: Managed (no native code)
- Navigation: Expo Router (file-based)

**Constraints:**
- Must use existing monorepo structure (workspaces in root package.json)
- Must configure for `android-twa/mklanguage.keystore` signing
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Expo project with managed workflow</name>
  <files>apps/mobile/package.json, apps/mobile/tsconfig.json, apps/mobile/babel.config.js, apps/mobile/.gitignore</files>
  <action>
Create `apps/mobile/` directory with a fresh Expo managed workflow project.

**Do NOT restore from git history** — create fresh to avoid stale dependencies.

1. Create directory structure:
```
apps/mobile/
├── app/                    # Expo Router pages
│   └── _layout.tsx         # Root layout (placeholder)
├── assets/                 # Icons, splash
├── components/             # Shared components
├── lib/                    # Utilities
├── store/                  # Zustand stores
├── app.config.ts           # Expo config
├── babel.config.js         # Babel config
├── tsconfig.json           # TypeScript config
├── package.json            # Dependencies
└── .gitignore              # Git ignore
```

2. Create `package.json` with:
- name: `@mk/mobile`
- Expo SDK 52 (latest stable)
- expo-router for navigation
- Core dependencies: react, react-native, expo
- Dev dependencies: typescript, @types/react

3. Create `babel.config.js` with expo preset

4. Create `tsconfig.json` extending expo's config

5. Create `.gitignore` for Expo (node_modules, .expo, builds, etc.)

6. Create placeholder `app/_layout.tsx` with basic Stack navigator

**Avoid:**
- Don't add all dependencies upfront — add incrementally as needed
- Don't copy old app code — reference patterns only
  </action>
  <verify>cd apps/mobile && npm install && npx expo doctor</verify>
  <done>apps/mobile/ exists with valid Expo project, npm install succeeds, expo doctor passes</done>
</task>

<task type="auto">
  <name>Task 2: Configure app.config.ts and eas.json</name>
  <files>apps/mobile/app.config.ts, apps/mobile/eas.json</files>
  <action>
1. Create `app.config.ts` with:

```typescript
import type { ConfigContext, ExpoConfig } from 'expo/config';

export default ({ config }: ConfigContext): ExpoConfig => ({
  ...config,
  name: 'Macedonian Language Lab',
  slug: 'mk-language-lab',
  scheme: 'mklanguage',
  version: '2.0.0',
  orientation: 'portrait',
  icon: './assets/icon.png',
  userInterfaceStyle: 'automatic',
  newArchEnabled: true,

  splash: {
    image: './assets/splash-icon.png',
    resizeMode: 'contain',
    backgroundColor: '#06060b',
  },

  ios: {
    supportsTablet: true,
    bundleIdentifier: 'com.mklanguage.app',
  },

  android: {
    package: 'com.mklanguage.app',  // CRITICAL: Match TWA for Play Store continuity
    adaptiveIcon: {
      foregroundImage: './assets/adaptive-icon.png',
      backgroundColor: '#06060b',
    },
    edgeToEdgeEnabled: true,
  },

  plugins: [
    'expo-router',
    'expo-secure-store',
  ],

  extra: {
    apiBaseUrl: process.env.EXPO_PUBLIC_API_BASE_URL ?? 'https://mk-language-lab.vercel.app',
    eas: {
      projectId: process.env.EAS_PROJECT_ID,
    },
  },

  experiments: {
    typedRoutes: true,
  },
});
```

2. Create `eas.json` with build profiles:

```json
{
  "cli": {
    "version": ">= 12.0.0",
    "appVersionSource": "remote"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      },
      "ios": {
        "simulator": true
      },
      "env": {
        "EXPO_PUBLIC_API_BASE_URL": "http://localhost:3000"
      }
    },
    "preview": {
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      },
      "env": {
        "EXPO_PUBLIC_API_BASE_URL": "https://mk-language-lab.vercel.app"
      }
    },
    "production": {
      "distribution": "store",
      "autoIncrement": true,
      "android": {
        "buildType": "app-bundle"
      },
      "env": {
        "EXPO_PUBLIC_API_BASE_URL": "https://mk-language-lab.vercel.app"
      }
    }
  },
  "submit": {
    "production": {
      "android": {
        "serviceAccountKeyPath": "./google-services.json",
        "track": "internal"
      }
    }
  }
}
```

3. Copy placeholder assets from web public folder or create simple placeholders:
   - `assets/icon.png` (1024x1024)
   - `assets/adaptive-icon.png` (1024x1024)
   - `assets/splash-icon.png` (1024x1024)

**Note:** Real assets will be refined in Phase 66 (Profile & Polish).
  </action>
  <verify>cd apps/mobile && npx expo config --type public | grep -q "com.mklanguage.app"</verify>
  <done>app.config.ts exports config with com.mklanguage.app package ID, eas.json has dev/preview/production profiles</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `apps/mobile/` directory exists with all required files
- [ ] `npm install` in apps/mobile succeeds
- [ ] `npx expo doctor` passes
- [ ] `npx expo config --type public` shows correct package ID
- [ ] Root `npm install` still works (monorepo integration)
</verification>

<success_criteria>

- Expo project created with managed workflow
- Package ID is `com.mklanguage.app` (verified)
- EAS build profiles configured
- Project integrates with monorepo workspaces
- Ready for auth implementation (next plan)
</success_criteria>

<output>
After completion, create `.planning/phases/61-foundation/61-01-SUMMARY.md`
</output>

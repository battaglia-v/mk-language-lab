---
phase: 61-foundation
plan: 03
type: execute
---

<objective>
Create tab navigation structure and Home screen with auth protection.

Purpose: Establish the app's navigation skeleton and authenticated landing page.
Output: Working tab navigation with Home, Learn, Practice, Reader, Profile tabs.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/61-foundation/61-01-SUMMARY.md
@.planning/phases/61-foundation/61-02-SUMMARY.md
@plan.md

# Web home page (reference for data)
@app/(main)/page.tsx

# Web navigation (reference for structure)
@components/navigation/

**Navigation structure:**
- Root layout: Auth check, redirect to sign-in if not authenticated
- Tab layout: Home, Learn, Practice, Reader, Profile
- Each tab is a placeholder for now (detailed in later phases)

**Dependencies from 61-02:**
- Auth store with user state
- API client for fetching user progress
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root layout with auth protection</name>
  <files>apps/mobile/app/_layout.tsx, apps/mobile/app/index.tsx</files>
  <action>
1. Update `app/_layout.tsx` as root layout:

```typescript
import { useEffect } from 'react';
import { Stack } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import { useAuthStore } from '../store/auth';
import { View, ActivityIndicator } from 'react-native';
import '../global.css';

export default function RootLayout() {
  const { isLoading, initialize } = useAuthStore();

  useEffect(() => {
    initialize();
  }, []);

  if (isLoading) {
    return (
      <View className="flex-1 bg-background items-center justify-center">
        <ActivityIndicator size="large" color="#f6d83b" />
      </View>
    );
  }

  return (
    <>
      <StatusBar style="light" />
      <Stack
        screenOptions={{
          headerShown: false,
          contentStyle: { backgroundColor: '#06060b' },
        }}
      >
        <Stack.Screen name="index" />
        <Stack.Screen name="sign-in" />
        <Stack.Screen name="register" />
        <Stack.Screen name="forgot-password" />
        <Stack.Screen name="(tabs)" />
      </Stack>
    </>
  );
}
```

2. Create `app/index.tsx` as entry point with auth redirect:

```typescript
import { useEffect } from 'react';
import { Redirect } from 'expo-router';
import { useAuthStore } from '../store/auth';

export default function Index() {
  const { isAuthenticated, isLoading } = useAuthStore();

  if (isLoading) {
    return null; // Root layout shows loading
  }

  if (isAuthenticated) {
    return <Redirect href="/(tabs)" />;
  }

  return <Redirect href="/sign-in" />;
}
```
  </action>
  <verify>cd apps/mobile && npx tsc --noEmit</verify>
  <done>Root layout initializes auth, index redirects based on auth state</done>
</task>

<task type="auto">
  <name>Task 2: Create tab navigation with 5 tabs</name>
  <files>apps/mobile/app/(tabs)/_layout.tsx, apps/mobile/app/(tabs)/index.tsx, apps/mobile/app/(tabs)/learn.tsx, apps/mobile/app/(tabs)/practice.tsx, apps/mobile/app/(tabs)/reader.tsx, apps/mobile/app/(tabs)/profile.tsx</files>
  <action>
1. Create `app/(tabs)/_layout.tsx`:

```typescript
import { Tabs } from 'expo-router';
import { Home, BookOpen, Dumbbell, BookText, User } from 'lucide-react-native';

export default function TabLayout() {
  return (
    <Tabs
      screenOptions={{
        headerShown: false,
        tabBarStyle: {
          backgroundColor: '#0b0b12',
          borderTopColor: '#222536',
          height: 80,
          paddingBottom: 20,
          paddingTop: 10,
        },
        tabBarActiveTintColor: '#f6d83b',
        tabBarInactiveTintColor: 'rgba(247,248,251,0.5)',
        tabBarLabelStyle: {
          fontSize: 11,
          fontWeight: '600',
        },
      }}
    >
      <Tabs.Screen
        name="index"
        options={{
          title: 'Home',
          tabBarIcon: ({ color, size }) => <Home color={color} size={size} />,
        }}
      />
      <Tabs.Screen
        name="learn"
        options={{
          title: 'Learn',
          tabBarIcon: ({ color, size }) => <BookOpen color={color} size={size} />,
        }}
      />
      <Tabs.Screen
        name="practice"
        options={{
          title: 'Practice',
          tabBarIcon: ({ color, size }) => <Dumbbell color={color} size={size} />,
        }}
      />
      <Tabs.Screen
        name="reader"
        options={{
          title: 'Reader',
          tabBarIcon: ({ color, size }) => <BookText color={color} size={size} />,
        }}
      />
      <Tabs.Screen
        name="profile"
        options={{
          title: 'Profile',
          tabBarIcon: ({ color, size }) => <User color={color} size={size} />,
        }}
      />
    </Tabs>
  );
}
```

2. Add lucide-react-native to dependencies

3. Create placeholder screens for each tab:

**app/(tabs)/learn.tsx:**
```typescript
import { View, Text } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';

export default function LearnScreen() {
  return (
    <SafeAreaView className="flex-1 bg-background">
      <View className="flex-1 items-center justify-center p-6">
        <Text className="text-2xl font-bold text-white mb-2">Learn</Text>
        <Text className="text-textMuted text-center">
          Lesson content coming in Phase 62
        </Text>
      </View>
    </SafeAreaView>
  );
}
```

**app/(tabs)/practice.tsx:**
```typescript
import { View, Text } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';

export default function PracticeScreen() {
  return (
    <SafeAreaView className="flex-1 bg-background">
      <View className="flex-1 items-center justify-center p-6">
        <Text className="text-2xl font-bold text-white mb-2">Practice</Text>
        <Text className="text-textMuted text-center">
          Practice sessions coming in Phase 63
        </Text>
      </View>
    </SafeAreaView>
  );
}
```

**app/(tabs)/reader.tsx:**
```typescript
import { View, Text } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';

export default function ReaderScreen() {
  return (
    <SafeAreaView className="flex-1 bg-background">
      <View className="flex-1 items-center justify-center p-6">
        <Text className="text-2xl font-bold text-white mb-2">Reader</Text>
        <Text className="text-textMuted text-center">
          Graded readers coming in Phase 64
        </Text>
      </View>
    </SafeAreaView>
  );
}
```

**app/(tabs)/profile.tsx:**
```typescript
import { View, Text, TouchableOpacity } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { useAuthStore } from '../../store/auth';

export default function ProfileScreen() {
  const { user, signOut } = useAuthStore();

  return (
    <SafeAreaView className="flex-1 bg-background">
      <View className="flex-1 p-6">
        <Text className="text-2xl font-bold text-white mb-2">Profile</Text>
        <Text className="text-textMuted mb-6">{user?.email}</Text>

        <TouchableOpacity
          className="bg-danger/20 border border-danger py-3 px-6 rounded-lg"
          onPress={signOut}
        >
          <Text className="text-danger font-semibold text-center">Sign Out</Text>
        </TouchableOpacity>
      </View>
    </SafeAreaView>
  );
}
```

4. Add react-native-safe-area-context to dependencies
  </action>
  <verify>cd apps/mobile && npx expo start --android (tabs should render)</verify>
  <done>5-tab navigation works, placeholder screens render, profile shows sign out</done>
</task>

<task type="auto">
  <name>Task 3: Build Home screen with progress data</name>
  <files>apps/mobile/app/(tabs)/index.tsx, apps/mobile/lib/progress.ts</files>
  <action>
1. Create `lib/progress.ts` for fetching user progress:

```typescript
import { apiFetch } from './api';

export interface UserProgress {
  currentLevel: 'A1' | 'A2' | 'B1';
  currentLesson: number;
  lessonsCompleted: number;
  totalLessons: number;
  streak: number;
  xp: number;
}

export async function fetchProgress(): Promise<UserProgress> {
  return apiFetch<UserProgress>('/api/progress');
}
```

2. Create `app/(tabs)/index.tsx` (Home screen):

```typescript
import { useEffect, useState } from 'react';
import { View, Text, TouchableOpacity, ScrollView, RefreshControl } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { router } from 'expo-router';
import { useAuthStore } from '../../store/auth';
import { fetchProgress, UserProgress } from '../../lib/progress';
import { BookOpen, Flame, Zap } from 'lucide-react-native';

export default function HomeScreen() {
  const { user } = useAuthStore();
  const [progress, setProgress] = useState<UserProgress | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isRefreshing, setIsRefreshing] = useState(false);

  const loadProgress = async () => {
    try {
      const data = await fetchProgress();
      setProgress(data);
    } catch (error) {
      console.error('Failed to load progress:', error);
    } finally {
      setIsLoading(false);
      setIsRefreshing(false);
    }
  };

  useEffect(() => {
    loadProgress();
  }, []);

  const onRefresh = () => {
    setIsRefreshing(true);
    loadProgress();
  };

  const firstName = user?.name?.split(' ')[0] || 'Learner';

  return (
    <SafeAreaView className="flex-1 bg-background">
      <ScrollView
        className="flex-1"
        contentContainerClassName="p-6"
        refreshControl={
          <RefreshControl
            refreshing={isRefreshing}
            onRefresh={onRefresh}
            tintColor="#f6d83b"
          />
        }
      >
        {/* Header */}
        <View className="mb-8">
          <Text className="text-textMuted text-sm mb-1">Welcome back,</Text>
          <Text className="text-3xl font-bold text-white">{firstName}</Text>
        </View>

        {/* Stats Row */}
        {progress && (
          <View className="flex-row gap-3 mb-8">
            <View className="flex-1 bg-surface border border-border rounded-xl p-4">
              <View className="flex-row items-center gap-2 mb-1">
                <Flame size={16} color="#f6d83b" />
                <Text className="text-textMuted text-xs">Streak</Text>
              </View>
              <Text className="text-2xl font-bold text-white">{progress.streak}</Text>
            </View>
            <View className="flex-1 bg-surface border border-border rounded-xl p-4">
              <View className="flex-row items-center gap-2 mb-1">
                <Zap size={16} color="#f6d83b" />
                <Text className="text-textMuted text-xs">XP</Text>
              </View>
              <Text className="text-2xl font-bold text-white">{progress.xp}</Text>
            </View>
            <View className="flex-1 bg-surface border border-border rounded-xl p-4">
              <View className="flex-row items-center gap-2 mb-1">
                <BookOpen size={16} color="#f6d83b" />
                <Text className="text-textMuted text-xs">Level</Text>
              </View>
              <Text className="text-2xl font-bold text-white">{progress.currentLevel}</Text>
            </View>
          </View>
        )}

        {/* Continue Learning Card */}
        {progress && (
          <TouchableOpacity
            className="bg-accent/10 border border-accent/30 rounded-2xl p-6 mb-6"
            onPress={() => router.push('/learn')}
          >
            <Text className="text-accent text-xs font-semibold uppercase tracking-wider mb-2">
              Continue Learning
            </Text>
            <Text className="text-white text-xl font-bold mb-2">
              {progress.currentLevel} â€¢ Lesson {progress.currentLesson}
            </Text>
            <View className="bg-background/50 rounded-full h-2 overflow-hidden">
              <View
                className="bg-accent h-full rounded-full"
                style={{
                  width: `${(progress.lessonsCompleted / progress.totalLessons) * 100}%`,
                }}
              />
            </View>
            <Text className="text-textMuted text-sm mt-2">
              {progress.lessonsCompleted} of {progress.totalLessons} lessons complete
            </Text>
          </TouchableOpacity>
        )}

        {/* Quick Actions */}
        <Text className="text-white font-semibold text-lg mb-4">Quick Actions</Text>
        <View className="gap-3">
          <TouchableOpacity
            className="bg-surface border border-border rounded-xl p-4 flex-row items-center"
            onPress={() => router.push('/practice')}
          >
            <View className="w-10 h-10 bg-accent/20 rounded-lg items-center justify-center mr-4">
              <Text className="text-xl">ðŸ’ª</Text>
            </View>
            <View className="flex-1">
              <Text className="text-white font-semibold">Practice</Text>
              <Text className="text-textMuted text-sm">Review vocabulary & grammar</Text>
            </View>
          </TouchableOpacity>

          <TouchableOpacity
            className="bg-surface border border-border rounded-xl p-4 flex-row items-center"
            onPress={() => router.push('/reader')}
          >
            <View className="w-10 h-10 bg-accent/20 rounded-lg items-center justify-center mr-4">
              <Text className="text-xl">ðŸ“š</Text>
            </View>
            <View className="flex-1">
              <Text className="text-white font-semibold">Reader</Text>
              <Text className="text-textMuted text-sm">Read graded stories</Text>
            </View>
          </TouchableOpacity>

          <TouchableOpacity
            className="bg-surface border border-border rounded-xl p-4 flex-row items-center"
            onPress={() => router.push('/translator')}
          >
            <View className="w-10 h-10 bg-accent/20 rounded-lg items-center justify-center mr-4">
              <Text className="text-xl">ðŸ”¤</Text>
            </View>
            <View className="flex-1">
              <Text className="text-white font-semibold">Translator</Text>
              <Text className="text-textMuted text-sm">Translate any text</Text>
            </View>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </SafeAreaView>
  );
}
```

3. Add translator placeholder route `app/translator.tsx` for now (detailed in Phase 65)
  </action>
  <verify>cd apps/mobile && npx expo start --android (Home should show user name and progress)</verify>
  <done>Home screen shows welcome message, stats, continue learning card, quick actions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] App launches and redirects to sign-in if not authenticated
- [ ] After sign-in, redirects to tabs
- [ ] 5 tabs visible: Home, Learn, Practice, Reader, Profile
- [ ] Home screen shows user name
- [ ] Profile screen shows sign out button that works
- [ ] Tab icons display correctly
</verification>

<success_criteria>

- Root layout handles auth initialization
- Tab navigation with 5 screens
- Home screen with progress data and quick actions
- Sign out works and redirects to sign-in
- Phase 61 (Foundation) complete
</success_criteria>

<output>
After completion, create `.planning/phases/61-foundation/61-03-SUMMARY.md`
</output>

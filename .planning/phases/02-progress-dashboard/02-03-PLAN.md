---
phase: 02-progress-dashboard
plan: 03
type: execute
---

<objective>
Remove beginner loop redirect behavior and replace hardcoded paths with DB curriculum.

Purpose: Users never get trapped in alphabet/beginner loop; progression follows UKIM curriculum.
Output: Learn page displays DB-driven curriculum lessons instead of hardcoded starter-path
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-progress-dashboard/02-01-PLAN.md
@.planning/phases/02-progress-dashboard/02-02-PLAN.md

# Key files
@app/[locale]/learn/page.tsx
@components/learn/LearnPageClient.tsx
@lib/learn/starter-path.ts
@lib/learn/a2-path.ts

# Current state (problems to fix)
- starterPath.ts and a2-path.ts are hardcoded lesson lists
- Progress is derived from totalLessons count, not actual completion
- The "node-1", "node-2" system doesn't map to CurriculumLesson IDs
- Users completing lessons don't see correct next lesson

# From 02-01 and 02-02
- Journey progress API returns curriculum position
- Continue CTA displays current lesson
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create curriculum path generator from database</name>
  <files>lib/learn/curriculum-path.ts</files>
  <action>
Create new module that generates LessonPath from CurriculumLesson database:

1. Export async function `getCurriculumPath(journeyId: string, userId?: string)`:
   - Query Module with CurriculumLessons for given journeyId (ukim-a1, ukim-a2, ukim-b1)
   - If userId provided, also query UserLessonProgress to mark completed lessons
   - Transform to LessonPath format with nodes

2. Map CurriculumLesson to LessonNode:
   - id: lesson.id (database ID, not "node-X")
   - type: 'lesson'
   - title: lesson.title
   - titleMk: (same as title since content is in Macedonian)
   - description: lesson.summary or first 100 chars of content
   - status: 'completed' | 'available' | 'locked' based on UserLessonProgress
   - xpReward: 20 (default)
   - href: `/learn/lessons/${lesson.id}`
   - contentId: lesson.id

3. Status logic:
   - completed: UserLessonProgress status='completed'
   - available: First incomplete lesson (or first lesson if none completed)
   - locked: Lessons after available lesson

Avoid: Making this a client-side fetch - it should be called from server component.
  </action>
  <verify>Import and call getCurriculumPath('ukim-a1') - returns LessonPath with 24 lessons from DB</verify>
  <done>Curriculum path generated from database with correct completion status</done>
</task>

<task type="auto">
  <name>Task 2: Replace hardcoded paths in Learn page</name>
  <files>app/[locale]/learn/page.tsx, components/learn/LearnPageClient.tsx</files>
  <action>
Update Learn page to use DB-driven curriculum:

1. In page.tsx:
   - Import getCurriculumPath
   - Replace createStarterPath/createA2Path calls with getCurriculumPath('ukim-a1') and getCurriculumPath('ukim-a2')
   - Pass user ID to get completion status

2. In LearnPageClient.tsx:
   - Update href generation - lessons now link to /learn/lessons/[lessonId] (database ID)
   - Remove dependency on hardcoded node IDs

3. Remove or deprecate:
   - Can keep lib/learn/starter-path.ts as fallback but mark deprecated
   - Eventually remove in cleanup phase

4. Update level switching:
   - "beginner" -> ukim-a1
   - "intermediate" -> ukim-a2

Avoid: Breaking the mobile tests - ensure data-testid attributes remain on key elements.
  </action>
  <verify>
1. Visit /learn - shows curriculum from database (24 A1 lessons)
2. Switch to A2 - shows 8 A2 lessons from database
3. Completed lessons show checkmark
4. data-testid="cta-start-here" still exists
  </verify>
  <done>Learn page displays DB-driven UKIM curriculum instead of hardcoded paths</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Curriculum-driven Learn page:
- Lessons from UKIM curriculum database
- Progress tied to actual lesson completion
- Continue CTA shows real position
  </what-built>
  <how-to-verify>
1. Run: npm run dev
2. Visit: http://localhost:3000/en/learn
3. Verify A1 path shows ~24 lessons with real titles from Тешкото
4. Click a lesson - should navigate to lesson page
5. Switch to A2 - should show ~8 lessons from Лозје
6. Check that lesson titles are in Macedonian (from curriculum)
7. If logged in, verify your progress state is reflected
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Learn page shows curriculum from database
- [ ] A1 shows Тешкото lessons (24)
- [ ] A2 shows Лозје lessons (8)
- [ ] Completion status reflects actual UserLessonProgress
- [ ] Lesson links work (/learn/lessons/[id])
- [ ] No hardcoded starter-path nodes visible
- [ ] npm run type-check passes
- [ ] Human verification approved
</verification>

<success_criteria>
- All tasks completed
- No more hardcoded lesson paths
- Progress tied to actual curriculum position
- User never redirected to alphabet unexpectedly
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-progress-dashboard/02-03-SUMMARY.md`:

Include:
- Curriculum path migration complete
- Files deprecated (starter-path.ts, a2-path.ts)
- User verification results
- Phase 2 summary stats
</output>

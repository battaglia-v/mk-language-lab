---
phase: 02-progress-dashboard
plan: 02
type: execute
---

<objective>
Update Learn page with "Continue where you left off" UX tied to UKIM curriculum.

Purpose: Users see their actual curriculum position and can resume from where they stopped.
Output: Learn page shows current lesson with Continue CTA, fetches position from API
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-progress-dashboard/02-01-PLAN.md

# Key files
@app/[locale]/learn/page.tsx
@components/learn/LearnPageClient.tsx
@lib/learn/starter-path.ts

# From 02-01
- GET /api/user/journey-progress returns current position
- JourneyProgress has currentModuleId, currentLessonId

# Current state
- Learn page uses totalLessons count to derive progress
- Does NOT query JourneyProgress for actual position
- Shows hardcoded starterPath nodes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fetch journey progress in Learn page server component</name>
  <files>app/[locale]/learn/page.tsx</files>
  <action>
Replace totalLessons-based progress with actual journey position:

1. Query JourneyProgress for authenticated user (include Module and CurriculumLesson)
2. If journey exists with currentLessonId:
   - Pass currentLesson (title, id, moduleTitle) to client
   - Pass progress stats (completedCount, totalCount)
3. If no journey exists:
   - User is new, show "Start Learning" state (existing behavior)
4. Remove the hardcoded Array.from logic that creates completedNodeIds from totalLessons count

Query should be efficient - single Prisma query with includes.

Avoid: Breaking the existing props interface to LearnPageClient - add new props alongside existing ones for gradual migration.
  </action>
  <verify>Visit /learn as logged-in user - page loads without errors, data is fetched</verify>
  <done>Learn page queries actual journey position from database</done>
</task>

<task type="auto">
  <name>Task 2: Display Continue CTA with current lesson info</name>
  <files>components/learn/LearnPageClient.tsx</files>
  <action>
Update client component to show "Continue where you left off":

1. Accept new props: currentLesson?: { id, title, moduleTitle, lessonNumber }, journeyProgress?: { completedCount, totalCount }
2. If currentLesson exists:
   - Show "Continue: [Lesson Title]" as primary CTA (instead of generic "Start Learning")
   - Display module name and lesson number
   - Link to /learn/lessons/[lessonId] or appropriate curriculum route
3. If no currentLesson (new user):
   - Keep existing "Start Learning" behavior
4. Show progress: "Lesson X of Y" or "X% complete"

Update translations: Add keys to messages/en.json and messages/mk.json:
- "continueLearning": "Continue Learning"
- "continueLesson": "Continue: {lessonTitle}"
- "lessonOf": "Lesson {current} of {total}"

Avoid: Removing the starter-path display entirely - this plan adds the Continue CTA, plan 02-03 handles replacing starter-path.
  </action>
  <verify>
1. User with journey progress sees "Continue: [Lesson Title]" CTA
2. New user still sees "Start Learning" CTA
3. No console errors, translations work in both locales
  </verify>
  <done>Continue CTA shows actual curriculum position for returning users</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Returning user sees Continue CTA with their current lesson
- [ ] New user sees Start Learning (existing behavior)
- [ ] Lesson title and module context displayed
- [ ] Progress percentage/count displayed
- [ ] Translations work (en + mk)
- [ ] npm run type-check passes
- [ ] npm run lint passes
</verification>

<success_criteria>
- Continue CTA tied to actual curriculum position
- Returning users see where they left off
- New user experience unchanged
- Both locales translated
</success_criteria>

<output>
After completion, create `.planning/phases/02-progress-dashboard/02-02-SUMMARY.md`
</output>

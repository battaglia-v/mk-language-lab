---
phase: 59-polish-branding
plan: 01
type: execute
---

<objective>
Fix Google Play Store compliance issues for Android 15+ and resolve TWA browser bar issue.

Purpose: Address Play Store warnings about edge-to-edge display, deprecated APIs, and orientation restrictions. Fix the "red browser wrapper" that makes the app look like a web page instead of native.
Output: Updated android-twa configuration passing Play Store compliance checks with seamless native experience.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Android TWA configuration
@android-twa/app/build.gradle
@android-twa/app/src/main/AndroidManifest.xml
@android-twa/app/src/main/java/com/mklanguage/app/LauncherActivity.java
@public/.well-known/assetlinks.json

**Google Play Store Issues (from screenshot):**
1. Edge-to-edge may not display for all users (Android 15 / SDK 35)
2. App uses deprecated APIs for edge-to-edge
3. Resizability and orientation restrictions block large screen devices

**User-Reported Issue:**
- Red browser wrapper visible - app doesn't look native
- Caused by: TWA verification failure showing Chrome UI in red themeColor

**Current State:**
- targetSdkVersion: 35 (correct)
- compileSdkVersion: 36 (correct)
- orientation: 'portrait-primary' (needs change)
- themeColor: '#D32F2F' (red - needs change to dark)
- assetlinks.json: only 1 fingerprint (needs Play Store key too)
- LauncherActivity: hardcoded SCREEN_ORIENTATION_PORTRAIT
- No EdgeToEdge.enable() call
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add EdgeToEdge support and update dependencies</name>
  <files>android-twa/app/build.gradle, android-twa/app/src/main/java/com/mklanguage/app/LauncherActivity.java</files>
  <action>
**1. Update build.gradle dependencies:**

Add the AndroidX Activity library for EdgeToEdge support:
```groovy
dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation 'com.google.androidbrowserhelper:locationdelegation:1.1.2'
    implementation 'com.google.androidbrowserhelper:androidbrowserhelper:2.6.2'
    // Add for EdgeToEdge support
    implementation 'androidx.activity:activity:1.9.0'
}
```

**2. Update LauncherActivity.java:**

Replace the entire file with:
```java
package com.mklanguage.app;

import android.net.Uri;
import android.os.Bundle;
import androidx.activity.EdgeToEdge;

public class LauncherActivity
        extends com.google.androidbrowserhelper.trusted.LauncherActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        // Enable edge-to-edge display for Android 15+
        EdgeToEdge.enable(this);
        super.onCreate(savedInstanceState);
        // Orientation now handled by manifest, not hardcoded
    }

    @Override
    protected Uri getLaunchingUrl() {
        return super.getLaunchingUrl();
    }
}
```

**Key changes:**
- Remove hardcoded setRequestedOrientation() calls
- Add EdgeToEdge.enable() before super.onCreate()
- Remove unused imports
  </action>
  <verify>cd android-twa && ./gradlew assembleDebug 2>&1 | tail -5</verify>
  <done>Build succeeds with EdgeToEdge support</done>
</task>

<task type="auto">
  <name>Task 2: Enable large screen support and update theme colors</name>
  <files>android-twa/app/build.gradle, android-twa/app/src/main/AndroidManifest.xml</files>
  <action>
**1. Update twaManifest in build.gradle:**

Change these values in the twaManifest block:
```groovy
def twaManifest = [
    applicationId: 'com.mklanguage.app',
    hostName: 'www.mklanguage.com',
    launchUrl: '/',
    name: 'MK Language Lab',
    launcherName: 'MK Language Lab',
    themeColor: '#080B12',          // Changed from '#D32F2F'
    themeColorDark: '#080B12',      // Changed from '#D32F2F'
    navigationColor: '#080B12',     // Changed from '#000000'
    navigationColorDark: '#080B12', // Changed from '#000000'
    navigationDividerColor: '#080B12',
    navigationDividerColorDark: '#080B12',
    backgroundColor: '#080B12',
    enableNotifications: true,
    shortcuts: [],
    splashScreenFadeOutDuration: 300,
    generatorApp: 'bubblewrap-cli',
    fallbackType: 'customtabs',
    enableSiteSettingsShortcut: 'true',
    orientation: 'default',         // Changed from 'portrait-primary'
]
```

**2. Update AndroidManifest.xml:**

Add to the LauncherActivity element:
```xml
<activity android:name="LauncherActivity"
    android:alwaysRetainTaskState="true"
    android:label="@string/launcherName"
    android:exported="true"
    android:resizeableActivity="true"
    android:configChanges="orientation|screenSize|screenLayout|smallestScreenSize">
```

Add to the application element:
```xml
<application
    ...
    android:resizeableActivity="true"
    ...>
```
  </action>
  <verify>grep -E "themeColor|orientation|resizeableActivity" android-twa/app/build.gradle android-twa/app/src/main/AndroidManifest.xml</verify>
  <done>Theme colors dark, orientation default, resizeableActivity enabled</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Get Play Store signing key fingerprint</action>
  <instructions>
    I need the Play Store signing key fingerprint to fix the TWA verification.

    **Steps:**
    1. Go to: https://play.google.com/console
    2. Select "MK Language Lab" app
    3. Navigate to: Setup â†’ App signing
    4. Find "App signing key certificate"
    5. Copy the SHA-256 fingerprint

    **Format:** XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX:XX

    Paste the fingerprint to continue.
  </instructions>
  <verification>Will add to assetlinks.json</verification>
  <resume-signal>Paste the SHA-256 fingerprint from Play Console</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Update assetlinks.json with Play Store fingerprint</name>
  <files>public/.well-known/assetlinks.json</files>
  <action>
Add the Play Store signing key fingerprint (provided in checkpoint) to assetlinks.json:

```json
[
  {
    "relation": ["delegate_permission/common.handle_all_urls"],
    "target": {
      "namespace": "android_app",
      "package_name": "com.mklanguage.app",
      "sha256_cert_fingerprints": [
        "4C:6D:EA:CF:77:55:3A:40:09:D8:94:5E:97:D1:9A:FC:8C:7D:B8:28:03:1F:A8:EC:6B:9F:73:FC:44:F7:D2:02",
        "FINGERPRINT_FROM_CHECKPOINT"
      ]
    }
  }
]
```

**Why both fingerprints:**
- First: Your upload/debug key
- Second: Google Play's signing key (used for Play Store distributed APKs)

Without both, TWA verification fails for users who installed from Play Store.
  </action>
  <verify>cat public/.well-known/assetlinks.json</verify>
  <done>assetlinks.json contains both fingerprints</done>
</task>

<task type="auto">
  <name>Task 4: Build release AAB</name>
  <files>android-twa/app/build/outputs/bundle/release/app-release.aab</files>
  <action>
**1. Increment version code in build.gradle:**
```groovy
defaultConfig {
    applicationId "com.mklanguage.app"
    minSdkVersion 21
    targetSdkVersion 35
    versionCode 6        // Increment from 5
    versionName "6"      // Increment from "5"
```

**2. Clean and build release:**
```bash
cd android-twa
./gradlew clean
./gradlew bundleRelease
```

**3. Verify AAB created:**
```bash
ls -la app/build/outputs/bundle/release/
```
  </action>
  <verify>ls android-twa/app/build/outputs/bundle/release/*.aab 2>/dev/null && echo "AAB built"</verify>
  <done>app-release.aab v6 built successfully</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `./gradlew assembleDebug` succeeds
- [ ] `./gradlew bundleRelease` creates app-release.aab
- [ ] EdgeToEdge.enable() in LauncherActivity
- [ ] resizeableActivity="true" in AndroidManifest
- [ ] orientation='default' in build.gradle
- [ ] themeColor='#080B12' (dark, not red)
- [ ] assetlinks.json has 2 fingerprints
- [ ] versionCode incremented to 6
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Release AAB builds successfully
- Android 15+ edge-to-edge enabled
- Large screen / foldable support enabled
- TWA theme colors match app (no red wrapper)
- assetlinks.json ready for deployment
- Ready for Play Store upload
</success_criteria>

<output>
After completion, create `.planning/phases/59-polish-branding/59-01-SUMMARY.md`
</output>

---
phase: 64-reader-flow
plan: 01
type: execute
---

<objective>
Mobile Reader API and Story List screen.

Purpose: Provide story data to mobile app and display browsable story list with level filters.
Output: Reader API endpoint, story list screen with filters and progress indicators.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/63-practice-flow/63-01-SUMMARY.md

# Web reader implementation patterns:
@lib/reader-samples.ts
@app/[locale]/reader/page.tsx

# Story data structure:
@data/reader/graded/a1-my-morning.json

# Mobile API patterns:
@app/api/mobile/practice/route.ts
@apps/mobile/lib/practice.ts

# Current mobile reader placeholder:
@apps/mobile/app/(tabs)/reader.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile reader API endpoint</name>
  <files>app/api/mobile/reader/route.ts</files>
  <action>
Create GET endpoint that returns graded reader stories for mobile app.

Response shape:
```typescript
type ReaderStory = {
  id: string;
  title_mk: string;
  title_en: string;
  difficulty: 'A1' | 'A2' | 'B1';
  estimatedMinutes: number;
  tags: string[];
  wordCount: number;
  text_blocks_mk: Array<{ type: string; value: string }>;
  vocabulary: Array<{ mk: string; en: string; pos?: string }>;
};

type ReaderApiResponse = {
  stories: ReaderStory[];
  meta: { total: number };
};
```

Import graded reader JSON files from `@/data/reader/graded/`.
Support query params:
- `?level=A1` - filter by difficulty
- `?id=a1-my-morning` - get single story with full content

For list mode (no id): Return stories without text_blocks_mk (just metadata).
For detail mode (with id): Return full story including text_blocks_mk and vocabulary.

Calculate wordCount from text_blocks_mk values.
  </action>
  <verify>curl http://localhost:3000/api/mobile/reader returns JSON with stories array</verify>
  <done>API returns story list and single story detail</done>
</task>

<task type="auto">
  <name>Task 2: Create reader lib and types</name>
  <files>apps/mobile/lib/reader.ts</files>
  <action>
Create reader library with types and fetch functions for mobile app.

```typescript
export type ReaderStory = {
  id: string;
  title_mk: string;
  title_en: string;
  difficulty: 'A1' | 'A2' | 'B1';
  estimatedMinutes: number;
  tags: string[];
  wordCount: number;
};

export type ReaderStoryDetail = ReaderStory & {
  text_blocks_mk: Array<{ type: string; value: string }>;
  vocabulary: Array<{ mk: string; en: string; pos?: string }>;
};

export async function fetchStories(level?: string): Promise<ReaderStory[]>;
export async function fetchStoryDetail(id: string): Promise<ReaderStoryDetail>;
```

Use apiFetch from existing api.ts. Handle errors gracefully.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Reader types and fetch functions available</done>
</task>

<task type="auto">
  <name>Task 3: Build story list screen</name>
  <files>apps/mobile/app/(tabs)/reader.tsx</files>
  <action>
Replace placeholder with story list screen.

UI structure:
- Header: "Reader" title
- Level filter chips: All, A1, A2, B1 (horizontal scroll)
- Story list: FlatList with story cards

Story card shows:
- Title (Macedonian)
- English subtitle
- Difficulty badge (color-coded: A1=green, A2=blue, B1=amber)
- Duration (e.g., "3 min")
- Word count (e.g., "45 words")

Tapping card navigates to `/reader/[id]` (route to be created in 64-02).

Use existing color scheme (#06060b background, #f6d83b accent).
Fetch stories on mount using fetchStories().
Show loading spinner while fetching.
Show error state with retry button if fetch fails.

Level filter changes re-fetch with level param.
  </action>
  <verify>npm run type-check passes in apps/mobile</verify>
  <done>Story list displays with level filtering</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes in apps/mobile
- [ ] API endpoint returns story list and detail
- [ ] Story list screen shows stories with filters
- [ ] Level filter chips work correctly
</verification>

<success_criteria>

- Mobile reader API serves graded reader data
- Story list screen displays with level filtering
- Story cards show title, difficulty, duration, word count
- Navigation to story detail prepared (route placeholder)
</success_criteria>

<output>
After completion, create `.planning/phases/64-reader-flow/64-01-SUMMARY.md`
</output>

---
phase: 19-cloudflare-research
plan: 01
type: execute
---

<objective>
Evaluate Cloudflare Pages/Workers as an alternative hosting platform for this Next.js app.

Purpose: Determine if migrating from Vercel to Cloudflare reduces costs and improves deploy process while maintaining feature parity.
Output: CLOUDFLARE-EVALUATION.md with compatibility analysis, cost comparison, and go/no-go recommendation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-ci-pipeline-audit/17-01-SUMMARY.md
@.planning/phases/18-ci-pipeline-improvements/18-01-SUMMARY.md
@.planning/codebase/STACK.md
@.planning/codebase/INTEGRATIONS.md
@.planning/codebase/ARCHITECTURE.md

**Tech stack available:**
- Next.js 16.0.10 (App Router, serverless-optimized)
- Prisma 6.19 with Neon PostgreSQL
- NextAuth v5 (beta)
- Vercel Analytics, Sentry for monitoring

**Key integration points to evaluate:**
- 36+ API routes using Next.js route handlers
- Server components with database queries via Prisma
- NextAuth session management
- Upstash Redis for rate limiting
- Google Cloud APIs (Translation, TTS)
- OpenAI API
- Sentry error tracking
- Vercel Analytics

**Constraining decisions:**
- Phase 17: All CI gates already exist, pipeline is optimized
- Phase 18: CI caching implemented (Next.js build cache, Playwright cache)

**v1.2 success criteria for Cloudflare:**
- [ ] Cloudflare Pages/Workers compatibility tested
- [ ] Cost comparison documented
- [ ] Migration feasibility assessed
- [ ] Go/no-go decision documented
</context>

<tasks>

<task type="auto">
  <name>Task 1: Research Cloudflare Next.js Support</name>
  <files>.planning/phases/19-cloudflare-research/CLOUDFLARE-EVALUATION.md</files>
  <action>
Research and document Cloudflare's Next.js support:

1. **@cloudflare/next-on-pages** - Official adapter for Next.js on Cloudflare Pages
   - Research current version and Next.js version compatibility
   - Check if Next.js 16 App Router is supported
   - Document known limitations

2. **Cloudflare Workers runtime differences:**
   - Node.js APIs available vs not available
   - File system access (relevant for Prisma)
   - Environment variable handling
   - Request/Response API differences

3. **Feature compatibility checklist:**
   - [ ] App Router with server components
   - [ ] API routes (route.ts handlers)
   - [ ] Middleware (middleware.ts)
   - [ ] Server-side rendering (SSR)
   - [ ] Incremental Static Regeneration (ISR)
   - [ ] Image optimization (next/image)
   - [ ] Internationalization (next-intl)

4. **Database connectivity:**
   - Prisma on Cloudflare Workers status (Prisma Accelerate or direct)
   - Neon PostgreSQL compatibility with edge runtime
   - Connection pooling requirements

Create initial CLOUDFLARE-EVALUATION.md with:
- Compatibility matrix for current features
- Known blockers or limitations
- Required code changes if any

Use WebFetch to research:
- https://developers.cloudflare.com/pages/framework-guides/nextjs/
- https://github.com/cloudflare/next-on-pages
- https://www.prisma.io/docs/orm/prisma-client/deployment/edge/overview
  </action>
  <verify>CLOUDFLARE-EVALUATION.md exists with compatibility matrix and blockers section</verify>
  <done>Compatibility analysis complete with clear yes/no/partial for each feature</done>
</task>

<task type="auto">
  <name>Task 2: Cost Comparison Analysis</name>
  <files>.planning/phases/19-cloudflare-research/CLOUDFLARE-EVALUATION.md</files>
  <action>
Research and document cost comparison between Vercel and Cloudflare:

**Vercel current usage patterns:**
- Serverless function invocations (API routes)
- Edge middleware execution
- Build minutes
- Bandwidth
- Analytics

**Cloudflare pricing research:**
- Pages free tier limits
- Workers paid tier pricing
- R2 storage (for image storage - already using S3-compatible)
- D1/Hyperdrive for database (if applicable)
- Analytics pricing

**Create cost comparison table:**
| Resource | Vercel (current) | Cloudflare | Savings |
|----------|------------------|------------|---------|
| Compute | ... | ... | ... |
| Bandwidth | ... | ... | ... |
| Storage | ... | ... | ... |
| Build | ... | ... | ... |

Use WebFetch to research:
- https://vercel.com/pricing
- https://www.cloudflare.com/plans/
- https://developers.cloudflare.com/workers/platform/pricing/

Add cost analysis section to CLOUDFLARE-EVALUATION.md
  </action>
  <verify>CLOUDFLARE-EVALUATION.md has cost comparison table with specific numbers</verify>
  <done>Cost comparison complete with estimated monthly costs for both platforms</done>
</task>

<task type="auto">
  <name>Task 3: Go/No-Go Recommendation</name>
  <files>.planning/phases/19-cloudflare-research/CLOUDFLARE-EVALUATION.md</files>
  <action>
Synthesize research into actionable recommendation:

1. **Feasibility assessment:**
   - Technical: Can the app run on Cloudflare with current architecture?
   - Effort: How much code/config change required?
   - Risk: What could break during migration?

2. **Decision matrix:**
   | Factor | Weight | Vercel | Cloudflare | Notes |
   |--------|--------|--------|------------|-------|
   | Cost | High | ... | ... | ... |
   | DX | Medium | ... | ... | ... |
   | Performance | Medium | ... | ... | ... |
   | Reliability | High | ... | ... | ... |
   | Lock-in | Low | ... | ... | ... |

3. **Recommendation:**
   - GO: If clear cost savings with acceptable effort
   - NO-GO: If major blockers or effort > benefit
   - DEFER: If edge cases need more investigation

4. **If GO - next steps for Phase 20:**
   - Migration checklist
   - Risk mitigation plan
   - Rollback strategy

Add recommendation section to CLOUDFLARE-EVALUATION.md with clear verdict
  </action>
  <verify>CLOUDFLARE-EVALUATION.md has "Recommendation" section with GO/NO-GO/DEFER and rationale</verify>
  <done>Go/no-go decision documented with clear rationale and next steps</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] CLOUDFLARE-EVALUATION.md created with all sections
- [ ] Compatibility matrix complete (all features evaluated)
- [ ] Cost comparison has specific numbers
- [ ] Go/no-go recommendation is clear and justified
- [ ] Next steps documented (for Phase 20)
</verification>

<success_criteria>

- All tasks completed
- CLOUDFLARE-EVALUATION.md is comprehensive and actionable
- v1.2 success criteria for Cloudflare section can be checked off
- Phase 20 scope is clear based on recommendation
  </success_criteria>

<output>
After completion, create `.planning/phases/19-cloudflare-research/19-01-SUMMARY.md`:

# Phase 19 Plan 01: Cloudflare Research & PoC Summary

**[One-liner: compatibility verdict, cost comparison result, recommendation]**

## Accomplishments

- [Key findings from research]

## Files Created/Modified

- `.planning/phases/19-cloudflare-research/CLOUDFLARE-EVALUATION.md` - Full evaluation report

## Decisions Made

- [GO/NO-GO/DEFER with brief rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Based on recommendation - what Phase 20 should do]
</output>

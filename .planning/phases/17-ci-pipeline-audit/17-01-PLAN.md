---
phase: 17-ci-pipeline-audit
plan: 01
type: execute
---

<objective>
Document existing CI pipeline workflows, identify gaps against v1.2 success criteria, and benchmark build times.

Purpose: Establish a clear baseline of current CI state before making improvements in Phase 18.
Output: CI-AUDIT.md report with workflow inventory, gap analysis, and optimization recommendations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/TESTING.md

**v1.2 Success Criteria to audit against:**
- [ ] All existing workflows documented and gaps identified
- [ ] Type checking gate added to CI
- [ ] Linting gate added to CI
- [ ] Unit test gate added to CI
- [ ] E2E test gate added to CI
- [ ] Build validation before deploy

**Current Workflows:**
- ci.yml - Main CI pipeline (lint, type-check, build, e2e, unit-tests, content-qa, i18n-check, mobile-maestro)
- e2e.yml - Standalone E2E (workflow_dispatch only, scheduled disabled)
- codex-deploy.yml - Manual Vercel deployment
- secret-scan.yml - Gitleaks secret detection
- deploy-notification.yml - Vercel deployment notifications
- reminder-cron.yml - Reminder cron smoke test (manual trigger only)
- agent-orchestration.yml - AI agent orchestration (manual trigger)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Analyze workflows and create CI audit report</name>
  <files>.planning/phases/17-ci-pipeline-audit/CI-AUDIT.md</files>
  <action>
Create comprehensive CI-AUDIT.md documenting:

1. **Workflow Inventory** - For each of 7 workflows:
   - Purpose and triggers (push, PR, schedule, manual)
   - Jobs and their dependencies
   - Runtime environment (ubuntu-latest, macos-latest)
   - Approximate duration (from GitHub Actions logs if available)
   - Required secrets

2. **Gap Analysis** - Compare against v1.2 success criteria:
   - Type checking: EXISTS (type-check job in ci.yml)
   - Linting: EXISTS (lint job in ci.yml)
   - Unit tests: EXISTS (unit-tests job in ci.yml)
   - E2E tests: EXISTS (e2e job in ci.yml with chromium only)
   - Build validation: EXISTS (build job in ci.yml)
   - Content QA: EXISTS (content-qa job in ci.yml) - BONUS
   - i18n check: EXISTS (i18n-check job in ci.yml) - BONUS
   - Secret scanning: EXISTS (secret-scan.yml) - BONUS

3. **Optimization Opportunities** - Identify:
   - Duplicate npm ci calls across jobs
   - Missing dependency caching
   - Jobs that could run in parallel vs. sequential
   - Long-running jobs that could be optimized
   - Disabled/commented features (scheduled E2E, Maestro without secrets)

4. **Risk Assessment**:
   - Jobs that can fail without blocking (mobile-maestro skips gracefully)
   - Critical path for deployment
   - Missing notifications or alerts

Format as markdown with tables for quick scanning.
  </action>
  <verify>cat .planning/phases/17-ci-pipeline-audit/CI-AUDIT.md | head -50</verify>
  <done>CI-AUDIT.md exists with workflow inventory, gap analysis, and optimization recommendations</done>
</task>

<task type="auto">
  <name>Task 2: Benchmark current CI pipeline times</name>
  <files>.planning/phases/17-ci-pipeline-audit/CI-AUDIT.md</files>
  <action>
Add a **Build Time Benchmarks** section to CI-AUDIT.md:

1. Run the following locally to get baseline times:
   - `time npm ci` (dependency install)
   - `time npm run lint` (ESLint)
   - `time npm run type-check` (TypeScript)
   - `time npm run build` (Next.js build)
   - `time npm run test` (Vitest unit tests)

2. Document approximate CI times based on:
   - Workflow structure (which jobs run parallel vs. sequential)
   - Estimated total pipeline time (sum of critical path)
   - Per-job estimates based on local benchmarks + CI overhead (~30-50%)

3. Identify bottlenecks:
   - Which job takes longest?
   - What's on the critical path for deployment?
   - Are there jobs that could be parallelized better?

Note: GitHub Actions logs would give exact CI times, but local benchmarks + overhead estimate is sufficient for planning.
  </action>
  <verify>grep -A 20 "Build Time" .planning/phases/17-ci-pipeline-audit/CI-AUDIT.md</verify>
  <done>CI-AUDIT.md includes benchmark section with timing data and bottleneck analysis</done>
</task>

<task type="auto">
  <name>Task 3: Update STATE.md and create recommendations for Phase 18</name>
  <files>.planning/STATE.md, .planning/phases/17-ci-pipeline-audit/CI-AUDIT.md</files>
  <action>
1. Add a **Phase 18 Recommendations** section to CI-AUDIT.md:
   - Prioritized list of improvements from optimization opportunities
   - Quick wins vs. larger efforts
   - Specific recommendations for Phase 18 scope

2. Update STATE.md:
   - Update current position to Phase 17 complete
   - Update progress percentage
   - Add any decisions or concerns discovered during audit
   - Update next step to Phase 18

3. Check v1.2 success criteria against findings:
   - Mark which criteria are already met
   - Note which need work in Phase 18
  </action>
  <verify>grep -A 5 "Current Position" .planning/STATE.md</verify>
  <done>CI-AUDIT.md has Phase 18 recommendations, STATE.md updated to reflect Phase 17 completion</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] CI-AUDIT.md exists in .planning/phases/17-ci-pipeline-audit/
- [ ] All 7 workflows documented with purpose, triggers, jobs
- [ ] Gap analysis against v1.2 success criteria complete
- [ ] Build time benchmarks recorded (local times + estimates)
- [ ] Optimization opportunities identified and prioritized
- [ ] Phase 18 recommendations documented
- [ ] STATE.md updated
</verification>

<success_criteria>

- CI-AUDIT.md provides complete picture of current CI state
- All v1.2 CI-related success criteria assessed
- Clear recommendations for Phase 18 improvements
- STATE.md reflects Phase 17 completion
</success_criteria>

<output>
After completion, create `.planning/phases/17-ci-pipeline-audit/17-01-SUMMARY.md`:

# Phase 17 Plan 01: CI Pipeline Audit Summary

**[Substantive one-liner about findings]**

## Accomplishments

- [Key findings]

## Files Created/Modified

- `.planning/phases/17-ci-pipeline-audit/CI-AUDIT.md` - Comprehensive audit report
- `.planning/STATE.md` - Updated project state

## Decisions Made

[Any decisions about CI approach]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Phase 18: CI Pipeline Improvements
</output>

---
phase: 65-translator
plan: 01
type: execute
---

<objective>
Mobile translator screen with bidirectional translation and history.

Purpose: Provide standalone translation tool for learning vocabulary.
Output: Translator tab screen with API integration and local history.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/64-reader-flow/64-03-SUMMARY.md

# Web translator patterns:
@app/[locale]/translate/page.tsx
@app/api/translate/route.ts

# Mobile API patterns:
@apps/mobile/lib/api.ts
@apps/mobile/lib/reader.ts

# Mobile AsyncStorage patterns:
@apps/mobile/lib/glossary.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create translation library</name>
  <files>apps/mobile/lib/translate.ts, apps/mobile/lib/translation-history.ts</files>
  <action>
Create translation types and functions.

translate.ts:
```typescript
export type TranslationDirection = 'en-mk' | 'mk-en';

export type TranslationResult = {
  translatedText: string;
  detectedSourceLang?: string | null;
};

export async function translateText(
  text: string,
  direction: TranslationDirection
): Promise<TranslationResult>;
```

Call existing /api/translate endpoint:
```
POST /api/translate
{ text, sourceLang, targetLang }
```

translation-history.ts:
```typescript
export type HistoryItem = {
  id: string;
  sourceText: string;
  translatedText: string;
  direction: TranslationDirection;
  timestamp: number;
};

export async function addToHistory(item: Omit<HistoryItem, 'id' | 'timestamp'>): Promise<void>;
export async function getHistory(): Promise<HistoryItem[]>;
export async function clearHistory(): Promise<void>;
```

Storage key: `@mklanguage/translation-history`
Limit to 20 most recent items.
  </action>
  <verify>Translation API calls work</verify>
  <done>Translation lib and history storage complete</done>
</task>

<task type="auto">
  <name>Task 2: Create translator screen</name>
  <files>apps/mobile/app/(tabs)/translate.tsx</files>
  <action>
Replace placeholder with translator screen.

UI structure:
- Direction toggle: EN → MK / MK → EN (segmented control)
- Swap direction button (↔️)
- Input TextInput with placeholder based on direction
- Character count (max 1800)
- Clear input button (X)
- Translate button (gradient yellow/amber)
- Result card with translation
- Copy to clipboard button
- Loading state while translating
- Error state with retry

Use existing color scheme (#06060b background, #f6d83b accent).

Direction labels:
- 'en-mk': "English → Macedonian"
- 'mk-en': "Macedonian → English"

Placeholders:
- 'en-mk': "Enter English text..."
- 'mk-en': "Внесете текст на македонски..."

Add to history after successful translation.
  </action>
  <verify>Translation works in both directions</verify>
  <done>Translator screen with API integration</done>
</task>

<task type="auto">
  <name>Task 3: Add history functionality</name>
  <files>apps/mobile/app/(tabs)/translate.tsx</files>
  <action>
Add history bottom sheet to translator screen.

Add History button (clock icon) in header.
On press: show Modal/bottom sheet with history list.

History item shows:
- Source text (truncated to 50 chars)
- Translated text (truncated to 50 chars)
- Direction badge (EN→MK or MK→EN)

Tapping history item:
- Loads sourceText into input
- Sets direction
- Does NOT auto-translate (let user review)

Add "Clear History" button at bottom of history sheet.
Show empty state when no history.
  </action>
  <verify>History loads and clears correctly</verify>
  <done>History functionality complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes in apps/mobile
- [ ] Translation works EN→MK and MK→EN
- [ ] History saves after translation
- [ ] History loads on tap
- [ ] Copy to clipboard works
</verification>

<success_criteria>

- Translator screen with bidirectional translation
- API integration with loading/error states
- Translation history persists locally
- Copy to clipboard functionality
- Phase 65 Translator complete

</success_criteria>

<output>
After completion, create `.planning/phases/65-translator/65-01-SUMMARY.md`
</output>

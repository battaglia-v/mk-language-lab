---
phase: 09-extraction-pipeline-fix
plan: 03
type: execute
---

<objective>
Extract B1 (Златоврв) PDF to create raw extraction file and initial structured output.

Purpose: B1 currently has only skeleton data with no raw extraction. Without b1-raw.json, Phase 13 cannot populate B1 content.
Output: data/curriculum/extracted/b1-raw.json and data/curriculum/structured/b1-zlatovrv.json with extracted content.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-extraction-pipeline-fix/09-02-SUMMARY.md

# Key files - existing extraction scripts to follow patterns from
@scripts/curriculum/extract-a1.ts
@scripts/curriculum/extract-a2.ts
@scripts/curriculum/extract-pdf.ts
@scripts/curriculum/create-b1-skeleton.ts

# Current B1 state:
# - b1-zlatovrv.json exists with skeleton structure (8 chapters, no content)
# - b1-raw.json does NOT exist (needs creation)
# - PDF exists at data/curriculum/raw/b1-zlatovrv.pdf (downloaded by npm run curriculum:download)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create B1 PDF extraction script</name>
  <files>scripts/curriculum/extract-b1.ts</files>
  <action>
Create extract-b1.ts following the pattern from extract-a1.ts:

1. Import extractPdfText from extract-pdf.ts
2. Define paths:
   - PDF_PATH = 'data/curriculum/raw/b1-zlatovrv.pdf'
   - OUTPUT_PATH = 'data/curriculum/extracted/b1-raw.json'

3. Extract text with positions (same as A1/A2 extractors)
4. Validate Macedonian-specific characters are present
5. Log statistics (pages, text items, font sizes)
6. Save raw extraction to b1-raw.json

Add npm script to package.json: "extract:pdf:b1": "npx tsx scripts/curriculum/extract-b1.ts"
  </action>
  <verify>npx tsx scripts/curriculum/extract-b1.ts && test -f data/curriculum/extracted/b1-raw.json</verify>
  <done>b1-raw.json exists with extracted pages, Cyrillic validation passes</done>
</task>

<task type="auto">
  <name>Task 2: Create B1 structure parser</name>
  <files>scripts/curriculum/parse-b1-structure.ts</files>
  <action>
Create parse-b1-structure.ts following the pattern from parse-a2-structure.ts:

1. Define LESSON_INFO with B1 chapters:
   - Get chapter titles from existing b1-zlatovrv.json skeleton
   - Estimate page numbers (will need manual verification or TOC parsing)

2. Import vocabulary and grammar extraction utilities:
   - From vocabulary-patterns.ts
   - From grammar-patterns.ts

3. Parse each lesson using the same pattern as A1/A2:
   - extractThemes()
   - extractVocabulary() using new patterns
   - extractGrammarNotes() using new patterns

4. Build structured output matching StructuredTextbook interface

Note: B1 may have different structure than A1/A2. Start with conservative extraction - Phase 13 will refine.

Add npm script: "parse:b1": "npx tsx scripts/curriculum/parse-b1-structure.ts"
  </action>
  <verify>npx tsx scripts/curriculum/parse-b1-structure.ts 2>&1 | grep -E "(Lesson|Vocabulary|Grammar)"</verify>
  <done>Parser runs without errors, produces output with vocabulary and grammar counts</done>
</task>

<task type="auto">
  <name>Task 3: Update B1 structured output and verify extraction</name>
  <files>data/curriculum/structured/b1-zlatovrv.json</files>
  <action>
Run the B1 parser to update structured output:

1. Run parse-b1-structure.ts to generate new b1-zlatovrv.json
2. Verify output has:
   - 8 chapters (as per existing skeleton)
   - vocabularyItems arrays (may be sparse initially)
   - grammarNotes arrays (may be sparse initially)
   - Proper metadata (extractedAt, parsedAt)

3. Compare with skeleton to ensure no loss of existing structure
4. Log summary statistics to console

Note: B1 targets are lower than A1/A2:
- Target: 5+ vocabulary items per lesson
- Target: Basic grammar notes present
Phase 13 will expand this content.
  </action>
  <verify>cat data/curriculum/structured/b1-zlatovrv.json | npx tsx -e "const d=JSON.parse(require('fs').readFileSync('/dev/stdin','utf8')); console.log('Chapters:', d.chapters.length); console.log('Vocab:', d.chapters.reduce((s,c)=>s+c.vocabularyItems.length,0)); console.log('Grammar:', d.chapters.reduce((s,c)=>s+c.grammarNotes.length,0));"</verify>
  <done>B1 has 8 chapters with vocabulary and grammar arrays populated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `data/curriculum/extracted/b1-raw.json` exists with pages array
- [ ] `data/curriculum/structured/b1-zlatovrv.json` updated from skeleton to full structure
- [ ] B1 has 8 chapters with vocabularyItems arrays
- [ ] B1 has grammarNotes arrays (can be sparse for now)
- [ ] npm scripts added for B1 extraction and parsing
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- B1 raw extraction file exists (~2-5 MB expected)
- B1 structured output has vocabulary and grammar arrays (sparse is OK)
- No TypeScript errors
- Phase 9 complete - extraction pipeline fixed for all levels
</success_criteria>

<output>
After completion, create `.planning/phases/09-extraction-pipeline-fix/09-03-SUMMARY.md`:

# Phase 9 Plan 03: B1 Extraction Summary

**[Summary of what was accomplished]**

## Accomplishments

## Files Created/Modified

## Decisions Made

## Issues Encountered

## Next Phase Readiness

- Phase 9 complete
- Ready for Phase 10: A1 Vocabulary Extraction (detailed content)
</output>

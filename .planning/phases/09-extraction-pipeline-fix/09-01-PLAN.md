---
phase: 09-extraction-pipeline-fix
plan: 01
type: execute
---

<objective>
Fix vocabulary extraction regex patterns to capture Macedonian-only word lists from UKIM textbooks.

Purpose: The current regex expects "Macedonian - English" format, but UKIM textbooks are entirely in Macedonian. This blocks all vocabulary extraction (0 items currently extracted vs 640+ expected).
Output: Updated parse-a1-structure.ts and parse-a2-structure.ts with working vocabulary extraction patterns.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-pdf-extraction-audit/08-01-SUMMARY.md
@.planning/phases/08-pdf-extraction-audit/AUDIT.md

# Key files
@scripts/curriculum/parse-a1-structure.ts
@scripts/curriculum/parse-a2-structure.ts
@scripts/curriculum/types.ts

# Patterns from audit (raw text samples):
# Page 17 A1: "еднина момче девојче татко мајка множина момчиња..." (tabular singular/plural)
# Page 23 A2: "зборови: татковина, земја, држава, живот..." (comma-separated after "зборови:")
# Page 12 A1: "Пополни ги празните места со горните зборови" (exercise instructions)

# Vocabulary formats identified:
# 1. Singular/plural pairs in tabular layout
# 2. Comma-separated lists after "зборови:" markers
# 3. Thematic word groupings (nouns, verbs, adjectives by category)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create vocabulary extraction utilities module</name>
  <files>scripts/curriculum/vocabulary-patterns.ts</files>
  <action>
Create a new module with vocabulary extraction functions:

1. `extractWordLists(text: string): string[]` - Extract words from comma-separated lists following "зборови:" or "Зборови:" markers
2. `extractSingularPluralPairs(text: string): Array<{singular: string, plural: string}>` - Extract noun pairs from tabular layouts (singular on left, plural on right)
3. `extractThematicVocabulary(text: string): Array<{word: string, category: string}>` - Extract words grouped by category (nouns, verbs, adjectives)

Key patterns to implement:
- "зборови:" followed by comma-separated Cyrillic words
- Two-column layouts with "еднина" and "множина" headers
- Word groupings preceded by part-of-speech markers

Do NOT try to extract English translations - they don't exist in these textbooks. The output type should change from `{macedonian: string, english: string}` to just `{word: string, context?: string}`.
  </action>
  <verify>npx tsc --noEmit scripts/curriculum/vocabulary-patterns.ts</verify>
  <done>Module compiles without errors, exports 3 extraction functions</done>
</task>

<task type="auto">
  <name>Task 2: Update A1 parser to use new vocabulary patterns</name>
  <files>scripts/curriculum/parse-a1-structure.ts, scripts/curriculum/types.ts</files>
  <action>
Update extractVocabulary() in parse-a1-structure.ts:

1. Import functions from vocabulary-patterns.ts
2. Remove the failing dashPattern regex that expects English translations
3. Call each extraction function and merge results
4. Update StructuredVocabulary interface:
   - Change from `{macedonian: string, english: string}` to `{word: string, partOfSpeech?: string, context?: string}`
   - This matches reality: no English exists in source PDFs

Run extraction and verify:
- Target: Extract 20+ vocabulary items per lesson (vs 0 currently)
- Total target: 200+ items for A1 (Phase 10 will refine to 480+)

Log extraction statistics for visibility.
  </action>
  <verify>npx tsx scripts/curriculum/parse-a1-structure.ts 2>&1 | grep -E "(Vocabulary|items)"</verify>
  <done>A1 parser runs without errors and logs vocabulary item counts > 0 for multiple lessons</done>
</task>

<task type="auto">
  <name>Task 3: Update A2 parser to use new vocabulary patterns</name>
  <files>scripts/curriculum/parse-a2-structure.ts</files>
  <action>
Update extractVocabulary() in parse-a2-structure.ts:

1. Import functions from vocabulary-patterns.ts (same as A1)
2. Remove the failing dashPattern regex
3. Call each extraction function and merge results
4. Use same StructuredVocabulary interface as A1 (from types.ts)

Run extraction and verify:
- Target: Extract 10+ vocabulary items per lesson (vs 0 currently)
- Total target: 80+ items for A2 (Phase 12 will refine to 120+)
  </action>
  <verify>npx tsx scripts/curriculum/parse-a2-structure.ts 2>&1 | grep -E "(Vocabulary|items)"</verify>
  <done>A2 parser runs without errors and logs vocabulary item counts > 0 for multiple lessons</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `npx tsx scripts/curriculum/parse-a1-structure.ts` produces vocabulary counts > 0
- [ ] `npx tsx scripts/curriculum/parse-a2-structure.ts` produces vocabulary counts > 0
- [ ] `data/curriculum/structured/a1-teskoto.json` contains vocabularyItems arrays with entries
- [ ] `data/curriculum/structured/a2-lozje.json` contains vocabularyItems arrays with entries
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- A1 extracts 200+ vocabulary items total (vs 0 before)
- A2 extracts 80+ vocabulary items total (vs 0 before)
- No TypeScript errors
- Type interface updated to reflect Macedonian-only vocabulary (no English field)
</success_criteria>

<output>
After completion, create `.planning/phases/09-extraction-pipeline-fix/09-01-SUMMARY.md`
</output>

---
phase: 37-tap-to-translate
plan: 02
type: execute
---

<objective>
Polish tap-to-translate UX with audio playback and visual refinements.

Purpose: Enhance the word lookup experience with TTS pronunciation and improved feedback, making the feature feel more polished and useful.

Output: WordBottomSheet with audio playback button; improved tap responsiveness and visual feedback.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-tap-to-translate/37-01-SUMMARY.md

**Key files:**
@components/reader/WordBottomSheet.tsx
@components/reader/TappableText.tsx
@components/reader/GlossaryDrawer.tsx (has working speechSynthesis example)
@lib/haptics.ts

**Tech available:**
- Browser speechSynthesis API for TTS
- GlossaryDrawer has working audio playback pattern (lines 60-65)
- Haptic feedback via `triggerHaptic()`
- Test: tests/release-gate/05-reader-word-tap.spec.ts expects audio button

**Patterns established:**
- Audio uses Serbian locale (`sr-RS`) as fallback for Macedonian
- Rate 0.8-0.85 for clearer pronunciation
- Audio button pattern: Volume2 icon, disabled state when unavailable
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add audio playback to WordBottomSheet</name>
  <files>components/reader/WordBottomSheet.tsx</files>
  <action>
  Add TTS pronunciation button to the word detail sheet:

  1. Import Volume2 icon from lucide-react
  2. Add state: `const [isPlaying, setIsPlaying] = useState(false)`
  3. Add audio handler following GlossaryDrawer pattern:
     ```typescript
     const handlePlayAudio = useCallback(() => {
       if (!word?.original || typeof window === 'undefined') return;
       if (!window.speechSynthesis) return;
       window.speechSynthesis.cancel();
       const utterance = new SpeechSynthesisUtterance(word.original);
       utterance.lang = 'sr-RS'; // Serbian as Macedonian fallback
       utterance.rate = 0.85;
       utterance.onstart = () => setIsPlaying(true);
       utterance.onend = () => setIsPlaying(false);
       utterance.onerror = () => setIsPlaying(false);
       window.speechSynthesis.speak(utterance);
     }, [word?.original]);
     ```
  4. Add audio button next to the word header (after phonetic, before difficulty badge):
     - Use data-testid="reader-word-sheet-audio"
     - Icon: Volume2, show AudioLines when playing
     - Disabled when speechSynthesis unavailable

  Follow existing button styling patterns in the component. Keep the button subtle (ghost variant).
  </action>
  <verify>
  Manual test: Tap a word in a reader, verify audio button appears and plays pronunciation.
  Run: `npm run type-check`
  </verify>
  <done>Audio button visible in WordBottomSheet; clicking plays pronunciation; test passes</done>
</task>

<task type="auto">
  <name>Task 2: Improve tap visual feedback</name>
  <files>components/reader/TappableText.tsx</files>
  <action>
  Enhance visual feedback for word taps:

  1. Add subtle ripple/pulse animation on tap (CSS keyframes):
     - Add `@keyframes tap-pulse` if not using Tailwind animate
     - Or use existing Tailwind: `animate-pulse` on active state

  2. Improve selected word styling:
     - Current: `bg-primary/40` - good
     - Add: brief `animate-[scale]` or transition for satisfying feedback
     - Consider: `shadow-sm shadow-primary/20` for depth

  3. Ensure touch-action is optimal:
     - Verify `touch-manipulation` class is present (it is)
     - Add `user-select-none` to prevent text selection interfering

  Keep changes minimal - the goal is polish, not redesign.
  DO NOT change the core tap handling logic - it works well.
  </action>
  <verify>
  Manual test on mobile (or Chrome DevTools device mode):
  - Tap a word, verify immediate visual feedback
  - Scroll while reading, verify taps don't trigger during scroll
  Run: `npm run type-check`
  </verify>
  <done>Word taps have improved visual feedback; no regressions in tap handling</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Audio playback and visual polish for tap-to-translate</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/en/reader/samples/a2-my-job
    3. Tap any word in the story
    4. Verify: Bottom sheet opens with word translation
    5. Verify: Audio button (speaker icon) is visible
    6. Click audio button - should play pronunciation
    7. Verify: Word tap has satisfying visual feedback (highlight/animation)
    8. Test scrolling - taps during scroll should not trigger
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Audio button visible in WordBottomSheet
- [ ] Audio plays Macedonian word pronunciation
- [ ] Visual tap feedback improved
- [ ] No regressions in tap handling (scroll vs tap distinction works)
- [ ] `npm run type-check` passes
- [ ] Release gate test still passes (if audio test exists)
</verification>

<success_criteria>
- WordBottomSheet has working audio playback
- Tap visual feedback feels polished
- Mobile touch handling remains reliable
- Phase 37 complete: Tap-to-translate fully polished
</success_criteria>

<output>
After completion, create `.planning/phases/37-tap-to-translate/37-02-SUMMARY.md`

This is the final plan for Phase 37.
</output>

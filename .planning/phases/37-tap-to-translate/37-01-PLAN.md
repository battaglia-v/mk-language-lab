---
phase: 37-tap-to-translate
plan: 01
type: execute
---

<objective>
Pre-analyze graded reader content for rich word lookups.

Purpose: Generate AI-powered word analysis (context hints, difficulty levels, alternatives) for all 12 graded readers so tap-to-translate shows rich data instead of basic vocabulary lookups.

Output: All 12 graded reader JSON files updated with `analyzedData` field containing word-by-word analysis.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-a2-reader-wiring/36-01-SUMMARY.md

**Key files:**
@scripts/pre-analyze-reader-samples.ts
@data/reader/graded/a2-my-job.json (example graded reader)
@components/reader/TappableText.tsx (uses analyzedData for rich lookups)

**Tech available:**
- Pre-analysis script exists, processes `data/reader/samples/day*.json`
- Google Translate API for word analysis (`/api/translate/analyze`)
- TappableText component already supports `analyzedData` for rich word info

**Patterns established:**
- ReaderSample interface with optional `analyzedData` field
- Word analysis includes: translation, alternativeTranslations, contextHint, pos, difficulty
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update pre-analysis script for graded readers</name>
  <files>scripts/pre-analyze-reader-samples.ts</files>
  <action>
  Modify the script to also process graded reader files:

  1. Add constant for graded readers directory: `data/reader/graded`
  2. Update `main()` to process both directories:
     - Keep existing `data/reader/samples/day*.json` processing
     - Add processing for `data/reader/graded/*.json` (all files, not just `day*` prefix)
  3. Extract common processing logic into a reusable function if not already
  4. Update console output to distinguish between sample types

  DO NOT change the analysis API call logic or rate limiting - those work correctly.
  </action>
  <verify>npm run type-check passes; script compiles without errors</verify>
  <done>Script updated to process both samples and graded directories; TypeScript compiles</done>
</task>

<task type="auto">
  <name>Task 2: Run pre-analysis on graded readers</name>
  <files>data/reader/graded/*.json (12 files)</files>
  <action>
  Run the updated pre-analysis script:

  1. Start dev server: `npm run dev` (needed for API)
  2. Run script: `npx tsx scripts/pre-analyze-reader-samples.ts`
  3. Wait for all 12 graded readers to be processed
  4. Verify each file has `analyzedData` field with words array

  Expected output: Each graded reader JSON should have:
  - `analyzedData.words[]` with translations, POS, difficulty
  - `analyzedData.metadata` with word/sentence counts
  - `analyzedData.fullTranslation` for the complete text

  If any fail (rate limiting, API errors), retry after 60 seconds.
  </action>
  <verify>
  Check that all 12 files have analyzedData:
  ```bash
  for f in data/reader/graded/*.json; do
    grep -q '"analyzedData"' "$f" && echo "✓ $f" || echo "✗ $f"
  done
  ```
  </verify>
  <done>All 12 graded reader files contain `analyzedData` field with word analysis</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Script updated and compiles (`npm run type-check`)
- [ ] All 12 graded readers have `analyzedData` field
- [ ] No regressions in existing 30-day challenge analysis
- [ ] Sample graded reader shows rich data when tapping words (manual test)
</verification>

<success_criteria>
- Pre-analysis script processes both `samples/` and `graded/` directories
- All 12 graded readers have `analyzedData` with word-level analysis
- TappableText shows difficulty badges and context hints for graded reader words
</success_criteria>

<output>
After completion, create `.planning/phases/37-tap-to-translate/37-01-SUMMARY.md`
</output>

---
phase: 43-vocabulary-grammar-audit
plan: 02
type: execute
---

<objective>
Audit and clean grammar notes to ensure clear, pedagogical explanations aligned with CEFR progression.

Purpose: Grammar notes have varying quality - some are clean pedagogical explanations while others contain raw PDF extraction artifacts (fragmented text, mixed Macedonian/English, incomplete explanations). All levels need consistent, learnable grammar content.
Output: Updated grammar notes in curriculum JSON files with clear explanations, consistent formatting, and CEFR-appropriate progression.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/43-vocabulary-grammar-audit/43-01-SUMMARY.md
@.planning/phases/43-vocabulary-grammar-audit/43-CONTEXT.md

# Grammar Data Sources (updated from 43-01)
@data/curriculum/structured/a1-teskoto.json
@data/curriculum/structured/a2-lozje.json
@data/curriculum/structured/b1-zlatovrv.json

# UI Component (for understanding display requirements)
@components/learn/GrammarSection.tsx

**Current State:**
- A1: 1-6 grammar notes per lesson, mostly well-formed
- A2: 1-7 grammar notes per lesson, many have PDF artifacts
- B1: 1-5 grammar notes per lesson, varying quality

**Quality Issues Found in A2/B1:**
1. Raw extraction fragments: "Г Р А М А Т И K A", "вуваат, преведуваат"
2. Incomplete explanations that trail off mid-sentence
3. Examples without clear translations
4. Redundant entries (same grammar concept appearing multiple times differently)
5. Mixed pedagogical text with exercise instructions

**Target State:**
- Each grammar note has:
  - Clear title (Macedonian with English subtitle if needed)
  - Pedagogical explanation in English (2-4 sentences)
  - 4-6 examples with translations
  - Consistent structure across all notes
- Progression appropriate: A1 simpler than A2 simpler than B1
- No PDF artifacts or incomplete text
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create grammar audit report script</name>
  <files>scripts/curriculum/grammar-audit-report.ts</files>
  <action>
Create a script that analyzes grammar notes across all levels:

1. **Per-lesson grammar stats:**
   - Number of grammar notes
   - Note titles (check for duplicates across lessons)
   - Content length and structure analysis

2. **Quality detection:**
   - **PDF artifacts:** Detect patterns like:
     - Spaced letters: "Г Р А М А Т И K A"
     - Incomplete sentences ending without punctuation
     - Raw Macedonian text in 'content' field (should be English explanation)
     - Exercise instructions mixed with grammar
   - **Weak translations:** Examples without corresponding translated examples
   - **Missing structure:** Notes without proper title/content/examples

3. **Duplication analysis:**
   - Same grammar concept appearing in multiple lessons
   - Identify canonical vs redundant entries

4. **CEFR alignment check:**
   - A1 topics: сум, има, present tense, basic pronouns, numbers
   - A2 topics: aspects, articles (-от/-ов/-он), да-constructions, past tenses
   - B1 topics: complex aspect, conditionals, reported speech

Output:
- Console summary with quality scores per level
- JSON report to `data/curriculum/grammar-audit.json`
- List of notes needing rewrite (by lesson number and note index)

Run with: `npx tsx scripts/curriculum/grammar-audit-report.ts`
  </action>
  <verify>Script runs without errors, grammar-audit.json created with quality metrics</verify>
  <done>Audit identifies notes needing cleanup, quality scores per level, duplication list</done>
</task>

<task type="auto">
  <name>Task 2: Clean and rewrite problematic grammar notes</name>
  <files>scripts/curriculum/clean-grammar-notes.ts, data/curriculum/structured/a1-teskoto.json, data/curriculum/structured/a2-lozje.json, data/curriculum/structured/b1-zlatovrv.json</files>
  <action>
Create a script that cleans grammar notes based on audit findings:

1. **Remove PDF artifacts:**
   - Strip spaced letter patterns
   - Remove incomplete sentences
   - Clean up mixed-language fragments

2. **Standardize structure:**
   - Ensure every note has: title, content (English), examples, translatedExamples
   - Content should be pedagogical (2-4 sentences explaining the grammar concept)
   - Examples should be Macedonian sentences
   - TranslatedExamples should be English translations

3. **Rewrite flagged notes:**
   For notes identified as needing rewrite in Task 1:
   - Use the CEFR framework from CONTEXT.md
   - Write clear English explanations
   - Provide practical examples

**Grammar templates by concept:**

A1 Core:
- Глаголот "сум" (to be) - conjugation table + usage
- Присвојни заменки (possessive pronouns) - gender agreement
- Броеви (numbers) - gender with 1-2

A2 Core:
- Членување (articles) - tripartite system -от/-ов/-он
- Да-конструкција (da-construction) - modal + da + verb
- Минато определено несвршено (imperfect) - past ongoing actions

B1 Core:
- Глаголски вид (verbal aspect) - perfective/imperfective pairs
- Идно време со ќе (future with ќе)
- Условни реченици (conditionals)

4. **Deduplicate:**
   - Keep canonical entry (usually first/best quality)
   - Remove redundant entries
   - Update lesson references if needed

The script should:
- Read JSON files
- Apply cleaning rules
- Write cleaned versions back to same files
- Log all changes made

Run with: `npx tsx scripts/curriculum/clean-grammar-notes.ts`
  </action>
  <verify>
- No PDF artifacts in any grammar note content
- Each grammar note has complete title/content/examples/translatedExamples
- Spot check: A2 Lesson 2 grammar notes are readable pedagogical text
  </verify>
  <done>Grammar notes cleaned, standardized structure across all levels, no PDF artifacts remain</done>
</task>

<task type="auto">
  <name>Task 3: Reseed and validate grammar content</name>
  <files>prisma/seed-curriculum-ukim.ts</files>
  <action>
1. **Reseed database with cleaned grammar:**
   ```bash
   npx prisma db seed
   ```

2. **Run content validation:**
   ```bash
   npx tsx scripts/curriculum/validate-content.ts
   ```

3. **Spot check in dev server:**
   - A1 Lesson 1: Check глаголот "сум" has clear explanation
   - A2 Lesson 2: Check да-конструкција is readable (not "Г Р А М А Т И K A")
   - B1 Lesson 4: Check imperfect explanation is pedagogical

4. **Update validation script if needed:**
   - Add grammar quality checks
   - Ensure all notes have required fields
  </action>
  <verify>
- `npx prisma db seed` completes successfully
- `npx tsx scripts/curriculum/validate-content.ts` passes
- Dev server shows readable grammar explanations
  </verify>
  <done>Database reseeded with cleaned grammar, validation passes, dev shows improved content</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `npm run lint` passes
- [ ] Grammar audit report exists at `data/curriculum/grammar-audit.json`
- [ ] No PDF artifacts ("Г Р А М А Т И K A" patterns) in any grammar note
- [ ] A2 Lesson 2 да-конструкција has clear English explanation
- [ ] All grammar notes have: title, content, examples, translatedExamples
- [ ] Database seeding completes without errors
</verification>

<success_criteria>

- All tasks completed
- Grammar notes have consistent, pedagogical structure
- PDF extraction artifacts removed
- CEFR-appropriate content per level
- Database reseeded with clean grammar
- Validation passes
</success_criteria>

<output>
After completion, create `.planning/phases/43-vocabulary-grammar-audit/43-02-SUMMARY.md`:

# Phase 43 Plan 02: Grammar Audit & Cleanup Summary

**[One-liner: e.g., "Cleaned 47 grammar notes with PDF artifacts, standardized structure across all levels"]**

## Accomplishments

- [Audit findings - notes with issues per level]
- [Cleanup results - number of notes rewritten]
- [Database reseed confirmation]

## Files Created/Modified

- `scripts/curriculum/grammar-audit-report.ts` - Audit script
- `scripts/curriculum/clean-grammar-notes.ts` - Cleanup script
- `data/curriculum/structured/*.json` - Updated grammar notes
- `data/curriculum/grammar-audit.json` - Audit report

## Decisions Made

[Decisions about grammar rewriting, deduplication choices]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 43 complete, ready for Phase 44: Content Completeness Audit
</output>

---
phase: 12.1-ux-fixes
plan: 01
type: execute
---

<objective>
Fix UX issues: complete data reset, remove reader audio, add English translations.

Purpose: Improve user experience with proper data management and bilingual content.
Output: Working reset progress, clean reader UX, translated curriculum content.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key files to modify:
@lib/local-storage-reset.ts - Current localStorage-only reset
@app/[locale]/settings/page.tsx - Settings page with Reset Progress button
@components/reader/WordBottomSheet.tsx - Audio playback on word tap
@data/curriculum/structured/a1-teskoto.json - A1 vocabulary (5,201 items)
@data/curriculum/structured/a2-lozje.json - A2 vocabulary (9,905 items)

# Reference for patterns:
@app/api/user/delete/route.ts - Existing account deletion pattern
@prisma/schema.prisma - Data models to clear

**Current Issues:**
1. "Reset Progress" only clears localStorage, not server data (lessons still show completed)
2. Reader plays audio when tapping words (undesired behavior)
3. No English translations for Macedonian vocabulary/grammar

**Scope:**
- Reset progress: Create API to clear GameProgress, LessonProgress, QuizAttempt, etc.
- Reader audio: Remove speechSynthesis calls from WordBottomSheet
- Translations: Add English translations to 15,106 vocabulary items + 119 grammar notes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reset progress API and update settings</name>
  <files>app/api/user/reset-progress/route.ts, lib/local-storage-reset.ts, app/[locale]/settings/page.tsx</files>
  <action>
1. Create new API endpoint `/api/user/reset-progress` (POST):
   - Authenticate user via session
   - Rate limit to prevent abuse
   - Delete user's progress data in transaction:
     ```typescript
     await prisma.$transaction([
       prisma.lessonProgress.deleteMany({ where: { userId } }),
       prisma.quizAttempt.deleteMany({ where: { userId } }),
       prisma.userVocabulary.deleteMany({ where: { userId } }),
       prisma.userBadge.deleteMany({ where: { userId } }),
       prisma.weeklyQuest.deleteMany({ where: { userId } }),
       prisma.gameProgress.updateMany({
         where: { userId },
         data: { xp: 0, level: 1, currentStreak: 0, longestStreak: 0, totalPracticeTime: 0, totalLessonsCompleted: 0, totalQuizzesTaken: 0, lastActivityAt: null }
       }),
     ]);
     ```
   - Return success response

2. Update settings page `handleResetProgress()`:
   - Call `/api/user/reset-progress` first (if authenticated)
   - Then call `clearAllLocalProgress()`
   - Show success/error toast

3. Add loading state during reset operation

Do NOT delete the User record itself - only progress/activity data.
  </action>
  <verify>
Build passes: npm run build
Manual test: Reset progress in settings â†’ lessons show as not completed, XP shows 0
  </verify>
  <done>Reset progress clears both localStorage and database, lessons show not completed, XP resets to 0</done>
</task>

<task type="auto">
  <name>Task 2: Remove reader audio on word tap</name>
  <files>components/reader/WordBottomSheet.tsx</files>
  <action>
Remove audio playback functionality from WordBottomSheet:

1. Delete `handlePlayAudio` callback function (lines ~86-99)
2. Delete `audioSupported` state and related useEffect
3. Remove audio button/icon from the bottom sheet UI
4. Keep the word display, translation, and other features intact

The SentenceAudioPlayer (for reading full sentences) should remain - only remove the per-word audio.

Also check TappableText.tsx for any audio triggers and remove if present.
  </action>
  <verify>npm run type-check && npm run build</verify>
  <done>Word tap opens bottom sheet without audio, no TypeScript errors, build passes</done>
</task>

<task type="auto">
  <name>Task 3: Add English translations to A1 vocabulary</name>
  <files>scripts/curriculum/translate-vocabulary.ts, data/curriculum/structured/a1-teskoto.json</files>
  <action>
Create translation script using Claude API for batch translation:

1. Create `scripts/curriculum/translate-vocabulary.ts`:
   - Load a1-teskoto.json
   - Extract unique Macedonian words (dedupe across lessons)
   - Batch translate using Claude API (50 words per request to stay within limits)
   - Prompt format: "Translate these Macedonian words to English. Return JSON array with {macedonian, english} pairs."
   - Cache translations to avoid re-translating
   - Update vocabulary items with `translation` field

2. Run translation:
   ```bash
   ANTHROPIC_API_KEY=xxx npx tsx scripts/curriculum/translate-vocabulary.ts --level a1
   ```

3. Verify translations added to JSON file

Translation should handle:
- Context hints where word has multiple meanings
- Part of speech preservation
- Special characters and Cyrillic text

Target: 5,201 A1 vocabulary items with English translations.
  </action>
  <verify>
npx tsx -e "
const data = require('./data/curriculum/structured/a1-teskoto.json');
let withTranslation = 0, total = 0;
for (const ch of data.chapters) {
  for (const v of ch.vocabularyItems) {
    total++;
    if (v.translation) withTranslation++;
  }
}
console.log('A1 translations:', withTranslation, '/', total);
process.exit(withTranslation < total * 0.9 ? 1 : 0);
"
  </verify>
  <done>90%+ of A1 vocabulary items have English translations</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `npm run build` succeeds
- [ ] Reset progress clears database AND localStorage
- [ ] Lessons show as not completed after reset
- [ ] XP shows 0 after reset
- [ ] Word tap in reader shows bottom sheet without audio
- [ ] A1 vocabulary has English translations populated
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Reset progress works end-to-end (verified manually)
- A1 vocabulary has 90%+ translation coverage
</success_criteria>

<output>
After completion, create `.planning/phases/12.1-ux-fixes/12.1-01-SUMMARY.md` with:
- Reset progress implementation details
- Audio removal confirmation
- Translation statistics (before/after counts)
- Any API costs incurred
</output>

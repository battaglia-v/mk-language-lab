---
phase: 27-bug-fixes
plan: 03
type: execute
---

<objective>
Add Macedonian keyboard hints to text input fields for better mobile UX.

Purpose: Help users switch to Macedonian keyboard when Cyrillic input is expected.
Output: Text inputs have lang="mk" attribute, visual keyboard hints appear when needed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-bug-fixes/27-RESEARCH.md

**Research findings (from 27-RESEARCH.md):**
- Web cannot programmatically switch keyboard language (OS-controlled)
- Can optimize with: `lang="mk"`, `inputmode="text"`, disable autocorrect
- Visual hint pattern: show "Switch to Macedonian keyboard" when Cyrillic expected
- Cyrillic detection: `/[\u0400-\u04FF]/` regex

**Affected files:**
- components/practice/word-sprint/TypedInput.tsx (already has autocorrect disabled, needs lang="mk")
- components/learn/GrammarExerciseCard.tsx (fill-in-blank inputs)
- components/ui/input.tsx (base component - accepts lang via props)

**Pattern from research:**
```tsx
<Input
  lang="mk"
  inputMode="text"
  autoComplete="off"
  autoCapitalize="off"
  spellCheck={false}
/>
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add lang="mk" to Macedonian text inputs</name>
  <files>components/practice/word-sprint/TypedInput.tsx, components/learn/GrammarExerciseCard.tsx</files>
  <action>
Add semantic keyboard attributes to text inputs expecting Macedonian/Cyrillic:

1. **TypedInput.tsx (lines 59-74)**
   - Add `lang="mk"` attribute to Input
   - Add `inputMode="text"` attribute (explicit, though it's the default)
   - Verify existing: `autoComplete="off"`, `autoCapitalize="off"`, `spellCheck={false}` (already present)

2. **GrammarExerciseCard.tsx**
   - Line 277-286 (fill-in-blank input): Add `lang="mk"`, `inputMode="text"`, `autoComplete="off"`, `spellCheck={false}`
   - Line 526-532 (correction exercise input): Same attributes

Why lang="mk" matters:
- Screen readers announce input as Macedonian
- Provides semantic hint to assistive technologies
- Some browsers may surface this to keyboard settings

Note: `inputMode="text"` is the default but making it explicit clarifies intent.
  </action>
  <verify>npm run type-check passes; inputs render with lang="mk" attribute (inspect in browser DevTools)</verify>
  <done>All Macedonian text inputs have lang="mk" and keyboard optimization attributes</done>
</task>

<task type="auto">
  <name>Task 2: Create KeyboardHint component</name>
  <files>components/ui/KeyboardHint.tsx</files>
  <action>
Create a reusable keyboard hint component (from research pattern):

```tsx
'use client';

import { Keyboard } from 'lucide-react';
import { cn } from '@/lib/utils';

type KeyboardHintProps = {
  show: boolean;
  className?: string;
};

export function KeyboardHint({ show, className }: KeyboardHintProps) {
  if (!show) return null;

  return (
    <div
      className={cn(
        'flex items-center gap-1.5 text-sm text-muted-foreground animate-in fade-in duration-300',
        className
      )}
    >
      <Keyboard className="h-4 w-4" />
      <span>Користете македонска тастатура</span>
    </div>
  );
}
```

Export from component (no barrel export needed for ui/ components).

This component:
- Shows only when `show` prop is true
- Uses Macedonian text for the hint
- Has fade-in animation for smooth appearance
- Accepts className for positioning flexibility
  </action>
  <verify>npm run type-check passes; component renders correctly when show={true}</verify>
  <done>KeyboardHint component created and ready for use</done>
</task>

<task type="auto">
  <name>Task 3: Integrate KeyboardHint into TypedInput</name>
  <files>components/practice/word-sprint/TypedInput.tsx</files>
  <action>
Add conditional keyboard hint to TypedInput:

1. Import KeyboardHint and add Cyrillic detection logic:
```tsx
import { KeyboardHint } from '@/components/ui/KeyboardHint';

// Add helper function or inline check
const containsCyrillic = (str: string) => /[\u0400-\u04FF]/.test(str);
```

2. Add state/memo to determine if hint should show:
```tsx
// Show hint when:
// - Input is empty (user hasn't started typing)
// - OR last typed character was Latin (user might be on wrong keyboard)
const shouldShowKeyboardHint = useMemo(() => {
  if (!value) return true; // Show on empty
  const lastChar = value.slice(-1);
  return !containsCyrillic(lastChar); // Show if typing Latin
}, [value]);
```

3. Add KeyboardHint below the input:
```tsx
<div className="space-y-2">
  <Input ... />
  <KeyboardHint show={shouldShowKeyboardHint && !disabled && !feedback} />
</div>
```

4. Hide hint when:
   - Input is disabled
   - Feedback is showing (correct/incorrect)
   - User is typing Cyrillic (they're on the right keyboard)

Why this UX: Users often forget to switch keyboards on mobile. A gentle reminder helps them switch before getting frustrated. Once they're typing Cyrillic, the hint disappears.
  </action>
  <verify>npm run type-check passes; test in browser: hint shows on empty input, disappears when typing Cyrillic, reappears if typing Latin</verify>
  <done>TypedInput shows keyboard hint when Cyrillic input expected but user may be on wrong keyboard</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Inspect inputs in DevTools - lang="mk" attribute present
- [ ] KeyboardHint shows on empty TypedInput
- [ ] KeyboardHint disappears when typing Cyrillic characters
</verification>

<success_criteria>

- All Macedonian text inputs have `lang="mk"` attribute
- KeyboardHint component created and integrated with TypedInput
- Hint shows conditionally (empty input or typing Latin)
- Hint hidden when disabled or showing feedback
- No TypeScript errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/27-bug-fixes/27-03-SUMMARY.md`
</output>

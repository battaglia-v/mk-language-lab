---
phase: 27-bug-fixes
plan: 01
type: execute
---

<objective>
Fix light mode color contrast issues and internationalize back button labels.

Purpose: Ensure UI components render correctly in both light and dark mode, and navigation labels are properly translated.
Output: Components use semantic color tokens, back buttons show localized labels.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md

**Prior Phase Context:**
Phase 26 established dark mode compliance with semantic design tokens. This plan addresses remaining hardcoded colors discovered after that phase.

**Pattern to follow:**
- Replace `text-black` on primary backgrounds with `text-primary-foreground`
- Replace `text-white` on colored backgrounds with appropriate foreground tokens
- Back buttons should use next-intl `useTranslations` hook

**Affected files identified:**
Light mode (13+ files):
- components/ui/PrimaryButton.tsx
- components/ui/badge.tsx
- components/ui/checkbox.tsx
- components/ui/CardButton.tsx
- components/ui/BuildInfo.tsx
- components/ui/filter-chip.tsx
- components/learn/LearnHeader.tsx
- components/learn/GrammarExerciseCard.tsx
- components/learn/LessonPathNode.tsx
- components/learn/DailyLessons.tsx
- components/reader/ReaderWorkspace.tsx
- components/reader/MarkCompleteButton.tsx
- components/reader/TextImporter.tsx
- components/reader/ReaderV2Layout.tsx
- components/reader/WordBottomSheet.tsx

Back buttons (3 files):
- components/reader/ReaderLayout.tsx (line 47)
- components/reader/ReaderV2Layout.tsx (lines 144, 167-170)
- components/learn/LessonPageContentV2.tsx (lines 830, 835)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix light mode colors in UI components</name>
  <files>components/ui/PrimaryButton.tsx, components/ui/badge.tsx, components/ui/checkbox.tsx, components/ui/CardButton.tsx, components/ui/BuildInfo.tsx, components/ui/filter-chip.tsx</files>
  <action>
Replace hardcoded `text-black` and `text-white` with semantic tokens:

1. **PrimaryButton.tsx (lines 74, 79)**
   - Change `text-black` to `text-primary-foreground`
   - Change `text-white` to appropriate foreground token

2. **badge.tsx (line 13)**
   - Change `text-black` on primary variant to `text-primary-foreground`

3. **checkbox.tsx (lines 30, 35)**
   - Change `peer-checked:text-black` to `peer-checked:text-primary-foreground`
   - Change check icon `text-black` to inherit from parent

4. **CardButton.tsx (lines 28, 48)**
   - Change `text-black` to `text-primary-foreground`
   - Change `text-black/70` to `text-primary-foreground/70`

5. **BuildInfo.tsx (line 21)**
   - Keep as-is (intentional overlay styling for debugging badge)

6. **filter-chip.tsx (line 21)**
   - Change `text-black` to `text-primary-foreground`

Pattern: Replace `text-black` with `text-primary-foreground` where it appears on `bg-primary` backgrounds. This ensures correct contrast in both light and dark modes.
  </action>
  <verify>npm run type-check passes; visually inspect components in both light and dark mode</verify>
  <done>UI components use semantic color tokens, no hardcoded text-black on primary backgrounds</done>
</task>

<task type="auto">
  <name>Task 2: Fix light mode colors in learn/reader components</name>
  <files>components/learn/LearnHeader.tsx, components/learn/GrammarExerciseCard.tsx, components/learn/LessonPathNode.tsx, components/learn/DailyLessons.tsx, components/reader/ReaderWorkspace.tsx, components/reader/MarkCompleteButton.tsx, components/reader/TextImporter.tsx, components/reader/ReaderV2Layout.tsx, components/reader/WordBottomSheet.tsx</files>
  <action>
Apply same pattern to learn and reader components:

1. **LearnHeader.tsx (line 73)**
   - Change `text-black` to `text-primary-foreground`

2. **GrammarExerciseCard.tsx (lines 363, 428)**
   - Change `text-black` to `text-primary-foreground` in multiple choice and sentence builder

3. **LessonPathNode.tsx (lines 42-44, 90)**
   - Update statusStyles: `text-black` → `text-primary-foreground` for available/in_progress states
   - Review completed state (already has dark: variant)

4. **DailyLessons.tsx (lines 471, 570, 693)**
   - Change `text-black` to `text-primary-foreground` for icons

5. **ReaderWorkspace.tsx (line 70)**
   - Keep `text-white` for direction buttons (intentionally high contrast on red/green)

6. **MarkCompleteButton.tsx (line 68)**
   - Keep `text-white` on emerald (intentional contrast)

7. **TextImporter.tsx (line 131)**
   - Change `file:text-black` to `file:text-primary-foreground`

8. **ReaderV2Layout.tsx (line 280)**
   - Change `text-black` to `text-primary-foreground` for badge

9. **WordBottomSheet.tsx (line 184)**
   - Change `text-black` to `text-primary-foreground`

Note: Some components (ReaderWorkspace, MarkCompleteButton) use intentional high-contrast white text on colored backgrounds - leave these as-is.
  </action>
  <verify>npm run type-check passes; npm run lint passes</verify>
  <done>Learn and reader components use semantic tokens where appropriate</done>
</task>

<task type="auto">
  <name>Task 3: Internationalize back button labels</name>
  <files>components/reader/ReaderLayout.tsx, components/reader/ReaderV2Layout.tsx, components/learn/LessonPageContentV2.tsx, messages/en.json, messages/mk.json</files>
  <action>
Fix back button labels to use next-intl translations:

1. **ReaderLayout.tsx (line 47)**
   - Add `useTranslations('common')` hook
   - Replace hardcoded "Back" with `t('back')`
   - Ensure aria-label also uses translation

2. **ReaderV2Layout.tsx (lines 144, 167-170)**
   - Translation `t.back` already defined (line 144)
   - Add visible text label alongside icon: `<span className="sr-only md:not-sr-only md:ml-1">{t.back}</span>`
   - Keep aria-label for accessibility

3. **LessonPageContentV2.tsx (lines 830, 835)**
   - Add `useTranslations('common')` hook
   - Replace hardcoded "Back" with `t('back')`

4. **messages/en.json and messages/mk.json**
   - Verify `common.back` key exists in both files
   - If missing, add: `"back": "Back"` (en) / `"back": "Назад"` (mk)

Pattern: All user-facing text should come from translation files, not be hardcoded.
  </action>
  <verify>npm run type-check passes; verify back buttons show "Back" in English and "Назад" in Macedonian by switching locale</verify>
  <done>Back buttons show translated labels in both English and Macedonian</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Visual inspection: primary buttons readable in light mode
- [ ] Visual inspection: back buttons show translated text
</verification>

<success_criteria>

- All hardcoded `text-black` on primary backgrounds replaced with `text-primary-foreground`
- Intentional high-contrast styling preserved (white on emerald/red/green)
- Back buttons display localized labels in both English and Macedonian
- No TypeScript errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/27-bug-fixes/27-01-SUMMARY.md`
</output>

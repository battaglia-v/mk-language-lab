---
phase: 03-lesson-practice-integrity
plan: 03
type: execute
---

<objective>
Add source lesson references to grammar drills so users know which UKIM lesson teaches each grammar concept.

Purpose: Connect standalone grammar exercises to curriculum context, helping users understand where they learned (or will learn) each concept.
Output: Grammar lessons display "Taught in: Lesson X" badges with curriculum references.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-lesson-practice-integrity/DISCOVERY.md

# Key source files:
@data/grammar-lessons.json
@app/[locale]/practice/grammar/page.tsx
@lib/grammar-engine.ts
@data/curriculum/structured/a1-teskoto.json

# Grammar lessons to map:
# - definite-article-basics -> UKIM A1 Lesson 1 (pronouns, "сум")
# - verb-conjugation-present -> UKIM A1 Lesson 3
# - etc.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create grammar-to-curriculum mapping</name>
  <files>data/grammar-curriculum-map.json</files>
  <action>
Create mapping file that links grammar lesson IDs to UKIM curriculum lessons:

```json
{
  "mappings": [
    {
      "grammarLessonId": "definite-article-basics",
      "curriculumRefs": [
        {
          "journeyId": "ukim-a1",
          "lessonNumber": 1,
          "lessonTitle": "Јас и ти",
          "relevance": "Introduces определен член with nouns"
        }
      ]
    },
    // ... more mappings
  ],
  "unmapped": [
    // Grammar lessons without clear curriculum match
  ]
}
```

Review grammar-lessons.json topics and match to UKIM curriculum:
- Check a1-teskoto.json grammarNotes for each lesson
- Match by topic (articles, verbs, pronouns, etc.)
- Some grammar may span multiple lessons or not have direct match

For unmapped grammar: leave curriculumRefs empty, note in "unmapped" array.
  </action>
  <verify>cat data/grammar-curriculum-map.json | head -30</verify>
  <done>Mapping file exists with grammar-to-curriculum references</done>
</task>

<task type="auto">
  <name>Task 2: Update grammar practice UI to show lesson references</name>
  <files>app/[locale]/practice/grammar/page.tsx</files>
  <action>
Add lesson reference badges to grammar lesson cards:

1. Import the mapping: `import grammarCurriculumMap from '@/data/grammar-curriculum-map.json'`

2. Create helper to get curriculum refs for a grammar lesson:
   ```typescript
   const getCurriculumRefs = (grammarLessonId: string) => {
     const mapping = grammarCurriculumMap.mappings.find(m => m.grammarLessonId === grammarLessonId);
     return mapping?.curriculumRefs ?? [];
   };
   ```

3. In the lesson card (inside the map over lessons), add below the difficulty badge:
   ```tsx
   {getCurriculumRefs(lesson.id).length > 0 && (
     <Badge variant="outline" className="text-xs bg-blue-500/10 text-blue-400 border-blue-500/30">
       <BookOpen className="h-3 w-3 mr-1" />
       {locale === 'mk' ? 'Лекција' : 'Lesson'} {getCurriculumRefs(lesson.id)[0].lessonNumber}
     </Badge>
   )}
   ```

4. Add translations to messages/en.json and messages/mk.json under grammar section:
   - "taughtIn": "Taught in" / "Научено во"

Keep the badge subtle - it's informational context, not primary UI.
  </action>
  <verify>grep -n "grammarCurriculumMap\|getCurriculumRefs\|taughtIn" app/[locale]/practice/grammar/page.tsx</verify>
  <done>Grammar cards show lesson reference badges for mapped lessons</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Grammar practice page now shows "Lesson X" badges linking grammar concepts to UKIM curriculum</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/en/practice/grammar
    3. Look at grammar lesson cards
    4. Verify: Cards with curriculum mappings show a blue "Lesson X" badge
    5. Verify: Badge shows correct lesson number from UKIM curriculum
    6. Verify: Cards without mappings don't show broken/empty badges
    7. Test in Macedonian: http://localhost:3000/mk/practice/grammar
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `npm run lint` passes
- [ ] Grammar mapping file exists
- [ ] Grammar UI shows lesson badges
- [ ] Human verified badges display correctly
</verification>

<success_criteria>

- Grammar-to-curriculum mapping created
- Grammar practice UI shows lesson references
- No TypeScript or lint errors
- Visual verification passed
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-lesson-practice-integrity/03-03-SUMMARY.md`
</output>

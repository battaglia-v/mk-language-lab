---
phase: 40-discovery-navigation
plan: 01
type: execute
---

<objective>
Add topic filtering, sort options, and improve story discovery experience in the Reader library.

Purpose: Help users find relevant reading content quickly based on their interests and learning goals.
Output: Enhanced Reader library with topic chips, sort dropdown, and improved empty states.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-reading-progress/39-01-SUMMARY.md

@app/[locale]/reader/page.tsx
@lib/reader-samples.ts
@components/reader/ReadingSampleCard.tsx
@data/graded-readers.json

**Tech stack available:** Next.js 16, React, shadcn/ui, Tailwind CSS
**Established patterns:**
- Difficulty filter chips with color coding (emerald/blue/purple/pink)
- Search input with clear button
- `ReadingSampleCard` with progress display
- `readAllProgress()` for reading progress lookup

**Constraining decisions:**
- Phase 39: Reading progress stored in localStorage via `mkll:reading-progress` key
- Phase 36: Graded readers categorized as 'story' type in reader-samples.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add topic filtering to Reader library</name>
  <files>app/[locale]/reader/page.tsx, lib/reader-samples.ts</files>
  <action>
1. In `lib/reader-samples.ts`:
   - Add `topic` field to `ReaderSample` interface (optional, string)
   - Add `getAvailableTopics()` function that returns unique topics from all samples
   - Update graded reader entries to include topic based on their category from graded-readers.json:
     - family → "Family"
     - daily-life → "Daily Life"
     - food → "Food"
     - travel → "Travel"
     - culture → "Culture"
   - Note: Challenge samples don't need topics (they're all "30-day Challenge")

2. In `app/[locale]/reader/page.tsx`:
   - Add `selectedTopic` state (string | null)
   - Create `availableTopics` memo from `getAvailableTopics()`
   - Add topic filter chips below difficulty chips (same styling pattern)
   - Update `filteredSamples` to filter by topic when selected
   - Update `clearFilters()` to also clear topic
   - Update `hasActiveFilters` to include topic check

Topic chips should appear when there's more than 1 topic available, using a neutral color scheme (gray/slate) to differentiate from difficulty colors.
  </action>
  <verify>
- `npm run type-check` passes
- Topic chips appear below difficulty chips
- Selecting a topic filters the sample list
- Clear all button clears both difficulty and topic
  </verify>
  <done>Topic filter chips work alongside difficulty filters, filtering Stories section accurately</done>
</task>

<task type="auto">
  <name>Task 2: Add sort options to Reader library</name>
  <files>app/[locale]/reader/page.tsx, components/ui/select.tsx</files>
  <action>
1. Add sort state: `sortBy` with options:
   - "default" (current order - by category then id)
   - "difficulty" (A1 first, then A2, then B1)
   - "duration" (shortest first)
   - "progress" (in-progress first, then unread, then completed)

2. Add sort dropdown UI:
   - Position: Right side of filter row, after difficulty/topic chips
   - Use shadcn Select component (already in project)
   - Label: "Sort by" with icon (ArrowUpDown from lucide)
   - Options: "Default", "Difficulty", "Reading Time", "My Progress"

3. Update `filteredSamples` memo:
   - After filtering, apply sort based on `sortBy` value
   - For "progress" sort, use `progressMap` to determine status (completed/in-progress/unread)

Keep sort state local (not in URL) since it's a view preference, not a filter.
  </action>
  <verify>
- Sort dropdown appears after filter chips
- Each sort option reorders the displayed samples correctly
- Progress sort groups: in-progress → unread → completed
  </verify>
  <done>Sort dropdown works with 4 options, correctly reordering samples in filtered view</done>
</task>

<task type="auto">
  <name>Task 3: Improve empty states and continue reading</name>
  <files>app/[locale]/reader/page.tsx</files>
  <action>
1. Add "Continue Reading" card at top of Library tab:
   - Show only when user has in-progress stories (progressPercent > 0 and not completed)
   - Display the most recently read story (highest lastReadAt)
   - Card style: Prominent gradient background (primary colors), similar to existing CTAs
   - Show: story title, progress bar, "Continue Reading" button
   - Position: After "Review saved words" CTA, before search/filters

2. Enhance empty state in search results:
   - When filters return no results, suggest:
     - If topic selected: "Try a different topic or clear filters"
     - If difficulty selected: "Try {adjacent difficulty} level"
   - Add quick-action buttons to clear specific filters

3. Add reading stats summary (optional - only show if user has history):
   - Small stats bar above content sections
   - Show: "{n} stories read", "{n} in progress"
   - Only render if user has any reading history
  </action>
  <verify>
- Continue Reading card appears when in-progress story exists
- Empty state has helpful suggestions based on active filters
- Stats summary shows accurate counts when reading history exists
  </verify>
  <done>Continue Reading prominently displayed, empty states guide users, reading stats visible</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run type-check` passes
- [ ] `npm run lint` passes (0 new warnings)
- [ ] Topic filter chips work and combine with difficulty filter
- [ ] Sort dropdown reorders samples correctly
- [ ] Continue Reading card appears for in-progress stories
- [ ] Empty states provide actionable guidance
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Topic and difficulty filters combine correctly
- Sort options work in filtered views
- Users can quickly find and continue their reading
</success_criteria>

<output>
After completion, create `.planning/phases/40-discovery-navigation/40-01-SUMMARY.md` following frontmatter template with:
- subsystem: reader
- tags: [filtering, discovery, sort, continue-reading]
- key-files listing modified files
- key-decisions about filter/sort UX choices
</output>

---
phase: 45-validation-polish
plan: 01
type: execute
---

<objective>
Validate v1.7 Learn Experience changes with E2E tests covering the simplified lesson flow, free navigation, and user journey continuity.

Purpose: Ensure the v1.7 milestone delivers on its promise â€” simplified lessons with free navigation while maintaining the core value "always resume in the right place, next step obvious."
Output: E2E test suite validating lesson flow, content quality, and cross-feature user journeys.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (v1.7 milestone)
@.planning/phases/42-lesson-flow-simplification/42-01-SUMMARY.md
@.planning/phases/43-vocabulary-grammar-audit/43-01-SUMMARY.md
@.planning/phases/43-vocabulary-grammar-audit/43-02-SUMMARY.md
@.planning/phases/44-content-completeness/44-01-SUMMARY.md

# Existing E2E patterns to follow
@e2e/user-journey.spec.ts
@e2e/lesson-runner.spec.ts
@.planning/codebase/TESTING.md

# Component under test
@components/learn/LessonPageContentV2.tsx

**Tech stack available:** Playwright 1.56.1, Vitest 4.0.0, E2E test patterns
**Established patterns:** data-testid attributes, networkidle waits, viewport-specific tests
**Constraining decisions:**
- Phase 42: Free navigation enabled unconditionally (canNavigate = true)
- Phase 42: Intro section removed, 4 sections max (dialogue, vocabulary, grammar, practice)
- Phase 43: Vocabulary curated to 30-50 words/lesson with first-appearance deduplication
- Phase 43: Grammar notes cleaned with standard templates
- Phase 44: Content gaps filled to match lesson intro promises
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create learn-experience E2E tests</name>
  <files>e2e/learn-experience.spec.ts</files>
  <action>
Create a new Playwright E2E test file validating the v1.7 Learn Experience changes:

**Test Suite 1: Lesson Flow**
- Lesson page loads with section stepper (not intro section)
- Section stepper shows available sections (vocabulary, grammar, practice at minimum)
- Clicking section tabs navigates freely without restrictions
- Progress indicator updates as sections are viewed
- Continue button advances to next section

**Test Suite 2: Content Quality**
- Vocabulary section displays word cards with Macedonian + English
- Grammar section displays notes with examples
- Practice section has exercises (at least one)
- No empty sections visible (sections only render if content exists)

**Test Suite 3: User Journey Continuity**
- Can navigate from Learn page to specific lesson
- Lesson completion state preserved (can return and see 100% progress)
- "Continue Learning" flow works from lesson back to Learn hub

**Mobile Suite:**
- Test at 375px viewport for mobile responsiveness
- No horizontal scroll on lesson page
- Touch targets >= 44px for section tabs

Follow patterns from e2e/user-journey.spec.ts:
- Use data-testid selectors where available
- Use networkidle waits
- Test both /en and /mk locales
- Include viewport-specific tests

The lesson route is /[locale]/learn/lessons/[lessonId]. Use a real A1 lesson (e.g., lesson 1) for testing.
  </action>
  <verify>npm run test:e2e -- e2e/learn-experience.spec.ts passes all tests</verify>
  <done>E2E tests cover lesson flow, content quality, and mobile responsiveness with all tests passing</done>
</task>

<task type="auto">
  <name>Task 2: Add data-testid attributes for testability</name>
  <files>components/learn/LessonPageContentV2.tsx</files>
  <action>
Add data-testid attributes to LessonPageContentV2 component to support E2E testing:

**Required testids:**
- `lesson-page-stepper` - The section stepper container
- `lesson-section-tab-{sectionId}` - Each section tab (vocabulary, grammar, practice, dialogue)
- `lesson-section-content` - The current section content area
- `lesson-progress-indicator` - Progress bar/indicator
- `lesson-continue-btn` - Continue/Next button
- `lesson-vocabulary-card` - Individual vocabulary cards
- `lesson-grammar-note` - Individual grammar notes
- `lesson-completion-screen` - Completion screen when all sections done

Only add testids - do not change any functionality. Add testids inline where elements are rendered.
  </action>
  <verify>grep -r "data-testid=\"lesson-" components/learn/LessonPageContentV2.tsx shows all required testids</verify>
  <done>All required data-testid attributes present in component</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>E2E test suite for v1.7 Learn Experience with testability attributes</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Navigate to: http://localhost:3000/en/learn/lessons/1
    3. Verify: Section tabs visible (Vocabulary, Grammar, Practice)
    4. Verify: Can click any tab freely without restrictions
    5. Verify: Vocabulary shows word cards, Grammar shows notes
    6. Run: npm run test:e2e -- e2e/learn-experience.spec.ts
    7. Confirm: All E2E tests pass
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run test:e2e -- e2e/learn-experience.spec.ts` passes all tests
- [ ] `npm run lint` passes (no new lint errors)
- [ ] `npm run type-check` passes (no TypeScript errors)
- [ ] Lesson page works end-to-end in browser (manual verification)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or lint errors introduced
- E2E tests validate: lesson flow, content quality, mobile responsiveness
- v1.7 milestone ready for release
</success_criteria>

<output>
After completion, create `.planning/phases/45-validation-polish/45-01-SUMMARY.md`:

# Phase 45 Plan 01: Learn Experience E2E Validation Summary

**[E2E test coverage for v1.7 Learn Experience - X tests validating lesson flow, content, and mobile]**

## Accomplishments

- Created learn-experience.spec.ts with E2E tests
- Added data-testid attributes for testability
- Validated simplified lesson flow works as designed
- Confirmed mobile responsiveness

## Files Created/Modified

- `e2e/learn-experience.spec.ts` - New E2E test suite
- `components/learn/LessonPageContentV2.tsx` - Added testid attributes

## Decisions Made

[Any decisions during implementation]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase complete. v1.7 milestone ready for release.
</output>

---
phase: 68-practice-modes
plan: 02
type: execute
---

<objective>
Improve Word Sprint mode with difficulty picker, combo system, and multiple input modes matching PWA.

Purpose: Transform basic Word Sprint into an engaging, gamified practice mode with progressive difficulty and streak mechanics.
Output: Word Sprint with difficulty picker (easy/medium/hard), combo multiplier system, and three input modes (multiple choice, word bank, typed).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary-frontmatter.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/68-practice-modes/68-01-SUMMARY.md

# PWA reference implementations:
@components/practice/word-sprint/WordSprintSession.tsx
@components/practice/word-sprint/DifficultyPicker.tsx
@components/practice/word-sprint/types.ts
@content/word-sprint/sentences.ts

# Mobile app patterns:
@apps/mobile/app/(tabs)/practice.tsx
@apps/mobile/app/practice/session.tsx
@apps/mobile/components/practice/MultipleChoiceCard.tsx
@apps/mobile/components/practice/TypingCard.tsx

**Tech stack available:** React Native, Expo Router, AsyncStorage
**Established patterns:** Practice card props, 48px touch targets, dark theme colors
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Word Sprint API endpoint with sentences data</name>
  <files>app/api/mobile/word-sprint/route.ts</files>
  <action>
Create GET /api/mobile/word-sprint endpoint that returns word sprint sentences.

Query params:
- difficulty: 'easy' | 'medium' | 'hard' (optional, returns all if not specified)
- count: number (default 10, max 50)

Response:
```typescript
type WordSprintItem = {
  id: string;
  mk: string;           // Full Macedonian sentence
  en: string;           // English translation
  missing: string;      // The word to fill in
  maskedMk: string;     // Sentence with ____ placeholder
  choices: string[];    // 4 multiple choice options (for easy mode)
  wordBank: string[];   // ~7 word tiles (for medium mode)
  difficulty: 'easy' | 'medium' | 'hard';
  category: string;
};

type WordSprintResponse = {
  items: WordSprintItem[];
  meta: { total: number; difficulty?: string };
};
```

Port getWordSprintSession logic from content/word-sprint/sentences.ts to the API:
- Filter by difficulty if specified
- Shuffle and slice to count
- Include choices and wordBank arrays for each item
- Add Cache-Control header (s-maxage=300)

Do NOT import the sentences.ts file directly - copy the data to a JSON file or inline it to avoid bundling issues.
  </action>
  <verify>curl "http://localhost:3000/api/mobile/word-sprint?difficulty=easy&count=5" returns JSON items</verify>
  <done>API returns word sprint items with choices/wordBank for each difficulty</done>
</task>

<task type="auto">
  <name>Task 2: Create Word Sprint with difficulty picker and full session</name>
  <files>apps/mobile/app/word-sprint/index.tsx, apps/mobile/app/word-sprint/session.tsx, apps/mobile/lib/word-sprint.ts, apps/mobile/components/word-sprint/DifficultyPicker.tsx, apps/mobile/components/word-sprint/WordBankInput.tsx</files>
  <action>
Create full Word Sprint experience matching PWA:

1. **apps/mobile/lib/word-sprint.ts** - API client and types:
   - fetchWordSprintSession(difficulty, count) → WordSprintItem[]
   - Types: WordSprintItem, Difficulty, SessionLength
   - XP constants: BASE_XP_PER_QUESTION = { easy: 5, medium: 8, hard: 12 }
   - Combo multiplier: getComboMultiplier(streak) → 1x/1.5x/2x/3x

2. **apps/mobile/components/word-sprint/DifficultyPicker.tsx**:
   - Three large difficulty cards (Easy/Medium/Hard)
   - Each shows: difficulty name, description, XP per question
   - Session length selector (10 or 20 questions)
   - "Start" button
   - Visual styling: Easy=emerald, Medium=amber, Hard=rose
   - Match PWA DifficultyPicker layout

3. **apps/mobile/components/word-sprint/WordBankInput.tsx**:
   - Display ~7 scrambled word tiles
   - User taps tiles to build answer
   - Selected tiles move to answer area
   - Tap answer tiles to deselect
   - Submit button when answer complete
   - For medium difficulty mode

4. **apps/mobile/app/word-sprint/index.tsx**:
   - Entry point showing DifficultyPicker
   - On select: navigate to session with difficulty param

5. **apps/mobile/app/word-sprint/session.tsx**:
   - Full screen session UI matching PWA WordSprintSession
   - Header: Exit button, progress bar, question counter, combo badge, difficulty badge
   - Card area: masked sentence, English translation, Listen button (TTS)
   - Input area varies by difficulty:
     - Easy: MultipleChoiceCard (4 options)
     - Medium: WordBankInput (tile tapping)
     - Hard: TypingCard (free text input with Macedonian hints)
   - Feedback: correct (green) / incorrect (amber) with correct answer shown
   - Auto-advance on correct (800ms delay), manual Continue on incorrect
   - Incorrect items re-inserted 2-3 positions ahead for retry
   - Track: currentCombo, bestCombo, totalXP, correctCount
   - On complete: show results with XP animation, retry/harder/finish options

6. **Update apps/mobile/app/(tabs)/practice.tsx**:
   - Change Word Sprint card to navigate to /word-sprint instead of /practice/session

Combo system:
- Correct answer increases combo, incorrect resets to 0
- XP = baseXP × comboMultiplier
- Multipliers: 1-4 streak = 1x, 5-9 = 1.5x, 10-14 = 2x, 15+ = 3x
- Display combo badge in header when streak > 0
  </action>
  <verify>cd apps/mobile && npx tsc --noEmit passes</verify>
  <done>Word Sprint has difficulty picker, three input modes, combo system, and completion screen</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes in root
- [ ] `cd apps/mobile && npx tsc --noEmit` passes
- [ ] Word Sprint API returns items with proper difficulty filtering
- [ ] Difficulty picker shows Easy/Medium/Hard options
- [ ] Easy mode uses multiple choice input
- [ ] Medium mode uses word bank tile input
- [ ] Hard mode uses typed input with Macedonian hints
- [ ] Combo badge appears and updates on correct streaks
- [ ] XP accumulates with combo multiplier
- [ ] Incorrect answers re-insert for retry
- [ ] Completion screen shows score, XP, best combo
</verification>

<success_criteria>
- Word Sprint accessible from Practice tab via difficulty picker
- Three difficulty modes with appropriate input types
- Combo system with visual feedback and XP multipliers
- Engaging game loop with auto-advance and retry mechanics
- Visual parity with PWA Word Sprint
</success_criteria>

<output>
After completion, create `.planning/phases/68-practice-modes/68-02-SUMMARY.md` following summary-frontmatter.md template.

Phase 68 complete after this plan - both Grammar Practice and Word Sprint improvements implemented.
</output>

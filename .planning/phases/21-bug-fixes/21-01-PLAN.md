---
phase: 21-bug-fixes
plan: 01
type: execute
---

<objective>
Fix vocabulary card interactivity and proper noun filtering in lesson pages.

Purpose: Users expect vocabulary cards to be tappable for more details (like the original VocabularySection). Names/surnames should not appear as learnable vocabulary.
Output: EnhancedVocabularyCard responds to taps in compact mode; proper nouns filtered from lesson vocabulary displays.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Key files:**
@components/learn/EnhancedVocabularyCard.tsx
@components/learn/LessonPageContentV2.tsx
@components/learn/VocabularySection.tsx (reference for filtering logic)

**Discovery findings:**
1. EnhancedVocabularyCard in "compact" mode (line 120-154) has no onClick handler and no cursor-pointer class - cards aren't interactive despite hover effects
2. LessonPageContentV2 passes vocabulary directly to EnhancedVocabularyCard without filtering proper nouns
3. VocabularySection has filterVocabulary() function that filters by partOfSpeech, but LessonPageContentV2 doesn't use it
4. Data already has proper nouns marked with partOfSpeech: "proper noun" and translations like "Ana (name)"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add interactivity to EnhancedVocabularyCard compact mode</name>
  <files>components/learn/EnhancedVocabularyCard.tsx</files>
  <action>
Update the compact mode rendering (around line 120-154) to:
1. Add onClick handler that toggles showing the example sentence (use existing showExample state)
2. Add cursor-pointer class to the Card
3. Show a "Tap for example" hint when an example sentence exists but is hidden
4. When tapped, reveal the example sentence (exampleSentenceMk/exampleSentenceEn) below the translation
5. Keep the design clean - only show the expand if there's actually an example sentence

Reference VocabularySection.tsx for the reveal animation pattern (opacity/max-h transitions).

Do NOT add audio playback or "add to review" buttons in compact mode - keep it focused on the example reveal.
  </action>
  <verify>npm run type-check && npm run lint</verify>
  <done>Compact mode cards show cursor-pointer, respond to clicks by revealing example sentences when available</done>
</task>

<task type="auto">
  <name>Task 2: Add vocabulary filtering to LessonPageContentV2</name>
  <files>components/learn/LessonPageContentV2.tsx</files>
  <action>
Add vocabulary filtering to exclude proper nouns and other non-learnable items:

1. Import or inline a simplified filtering function (based on VocabularySection's filterVocabulary)
2. In the groupedVocabulary useMemo (around line 301), filter the vocabulary BEFORE grouping:
   - Filter out items with partOfSpeech === "proper noun"
   - Filter out items where englishText contains "(name)"
   - Filter out items where macedonianText is in a blocklist of common names: ['Ана', 'Марко', 'Петар', 'Ива', 'Маја', 'Сара', 'Лука', 'Ема', 'Влатко', 'Андреј', 'Весна', 'Марија', 'Ивана', 'Ѓорѓи', 'Новак', 'Томислав']
   - Filter out country names already in COUNTRY_NAMES set from VocabularySection

Keep it simple - the goal is to filter out names, not implement complex heuristics. Trust partOfSpeech and the (name) marker.

The filtered vocabulary should then be used for grouping/display.
  </action>
  <verify>npm run type-check && npm run lint</verify>
  <done>Proper nouns (names, countries) no longer appear in lesson vocabulary sections</done>
</task>

<task type="auto">
  <name>Task 3: Manual verification and commit</name>
  <files>N/A</files>
  <action>
1. Start dev server: npm run dev
2. Navigate to a lesson known to have names (e.g., A1 Lesson 1)
3. Verify:
   - No names like "Ана", "Марко", "Влатко" appear in vocabulary
   - Vocabulary cards with examples show cursor-pointer
   - Tapping a card reveals the example sentence
4. Check a few more lessons to ensure filtering works broadly

If everything works, commit the changes with a descriptive message.
  </action>
  <verify>npm run build (full build check)</verify>
  <done>Dev server shows filtered vocabulary, cards are interactive, build passes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run type-check` passes
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds
- [ ] EnhancedVocabularyCard compact mode responds to clicks
- [ ] Proper nouns don't appear in lesson vocabulary
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or ESLint errors introduced
- Vocabulary cards are interactive (tap reveals example)
- Names and proper nouns filtered from vocabulary displays
</success_criteria>

<output>
After completion, create `.planning/phases/21-bug-fixes/21-01-SUMMARY.md`:

# Phase 21 Plan 01: Vocabulary Bug Fixes Summary

**[One-liner describing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 21 complete, ready for Phase 22: Content Effectiveness Audit
</output>

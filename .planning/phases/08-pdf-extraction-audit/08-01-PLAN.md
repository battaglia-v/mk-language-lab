---
phase: 08-pdf-extraction-audit
plan: 01
type: execute
---

<objective>
Analyze current PDF extraction output quality and document specific issues per CEFR level.

Purpose: Create a comprehensive audit report showing exactly what's broken before attempting fixes. This audit will guide the extraction pipeline improvements in Phase 9.

Output: AUDIT.md document with quantified issues, pattern analysis, and recommended fixes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current extraction infrastructure:
@scripts/curriculum/extract-pdf.ts
@scripts/curriculum/parse-a1-structure.ts
@scripts/curriculum/parse-a2-structure.ts

# Current output data:
@data/curriculum/structured/a1-teskoto.json
@data/curriculum/structured/a2-lozje.json
@data/curriculum/structured/b1-zlatovrv.json

**Known issues from initial analysis:**
- A1: 24 lessons, 0 vocabulary items, 7 grammar notes (6 are duplicates)
- A2: 8 lessons, 0 vocabulary items, 34 grammar notes (placeholders only)
- B1: 8 lessons, skeleton only (no content)

**Root cause hypothesis:**
- Vocabulary extraction pattern assumes "Macedonian - English" format, but UKIM textbooks are Macedonian-only
- Grammar detection uses hardcoded keyword matching, missing actual grammar explanations
- No attempt to extract vocabulary from exercises, word boxes, or glossaries
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create extraction audit script</name>
  <files>scripts/curriculum/audit-extraction.ts</files>
  <action>
Create a TypeScript script that analyzes the current extraction output and generates statistics:

1. For each level (A1, A2, B1), count:
   - Total lessons
   - Vocabulary items per lesson (should be 20+ for usable practice)
   - Grammar notes per lesson
   - Grammar notes with actual explanations vs placeholders
   - Grammar notes with 3+ examples

2. Sample raw text quality checks:
   - Count Macedonian-specific characters (ѓ, ќ, љ, њ, џ) to verify encoding
   - Check for OCR artifacts (repeated characters, broken words)
   - Identify vocabulary-rich pages (tables, word lists)

3. Pattern analysis:
   - Find "Речник" (vocabulary) sections in raw text
   - Find "Граматика" (grammar) sections
   - Count potential vocabulary entries (Cyrillic words with spaces)

Output JSON with all statistics to data/curriculum/audit-results.json
  </action>
  <verify>npx tsx scripts/curriculum/audit-extraction.ts runs without error and produces audit-results.json</verify>
  <done>Audit script exists and generates statistics JSON</done>
</task>

<task type="auto">
  <name>Task 2: Generate audit report document</name>
  <files>.planning/phases/08-pdf-extraction-audit/AUDIT.md</files>
  <action>
Using the audit script output, create a markdown report documenting:

## Executive Summary
- Current state: X total vocabulary items, Y grammar notes across all levels
- Target state: A1 20+ vocab per lesson, A2 15+ vocab per lesson, B1 skeleton
- Gap: Quantified missing content

## Issue Analysis by Level

### A1 (Тешкото)
- Vocabulary extraction: [X items found vs Y expected]
- Root cause: [specific pattern failures]
- Example from raw text showing extractable content that was missed

### A2 (Лозје)
- Similar structure

### B1 (Златоврв)
- Skeleton status

## Pattern Failure Analysis
- Current vocabulary regex: `([А-Яа-яЀ-ӿ]+) - ([a-zA-Z]+)` fails because no English translations exist
- Grammar keyword matching only finds 2 patterns, misses actual grammar sections

## Recommended Fixes (for Phase 9)
1. Extract vocabulary from:
   - "Речник" sections
   - Exercise word boxes
   - Vocabulary tables
2. Extract grammar from:
   - "Граматика" headers
   - Explanation paragraphs
   - Example sentences

## Text Quality Assessment
- Encoding: [OK/Issues]
- OCR quality: [assessment]
- Structural markers preserved: [yes/no]
  </action>
  <verify>AUDIT.md exists with all sections populated</verify>
  <done>Complete audit document with quantified issues and recommendations</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Audit script runs successfully
- [ ] audit-results.json contains statistics for all 3 levels
- [ ] AUDIT.md documents all issues with specific examples
- [ ] Root causes identified for vocabulary extraction failure
- [ ] Recommendations ready for Phase 9 implementation
</verification>

<success_criteria>
- Audit script creates quantified statistics
- AUDIT.md provides clear gap analysis
- Root causes documented with specific regex/pattern failures
- Phase 9 can proceed with concrete fix targets
</success_criteria>

<output>
After completion, create `.planning/phases/08-pdf-extraction-audit/08-01-SUMMARY.md` following the summary template.
</output>

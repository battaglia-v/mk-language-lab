---
phase: 34-remaining-polish
plan: 02
type: execute
---

<objective>
Improve lesson exercise and navigation UX with quiz retake functionality and better section stepper behavior.

Purpose: Make it easier for users to practice exercises again and navigate completed lessons.
Output: Quiz retake button, improved section stepper navigation for revisiting completed lessons.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./34-02-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key files:
@components/learn/ExerciseSection.tsx
@components/learn/LessonPageContentV2.tsx
@messages/en.json
@messages/mk.json

**Background:**
- ExerciseSection has individual "Try Again" buttons per exercise when wrong
- No overall "Retake Quiz" button to reset all exercises at once
- Section stepper (lines 922-968) restricts forward navigation: `disabled={index > currentSectionIndex && !isCompleted}`
- When lesson was previously completed (userProgress.progress === 100), user starts at last section but can't easily jump to earlier sections
- Current behavior: can only navigate to sections you've visited in THIS session or that are marked complete
- Desired behavior: if lesson previously completed, allow free navigation to ALL sections
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add quiz retake button to ExerciseSection</name>
  <files>components/learn/ExerciseSection.tsx, messages/en.json, messages/mk.json</files>
  <action>
Add a "Retake Quiz" button that appears when all exercises have been attempted:
1. Add state to track if quiz was completed: `const quizCompleted = completedCount === totalExercises && totalExercises > 0`
2. Add `handleRetakeAll` function that resets all state: answers, checked, results, hintsShown, matchingSelections, selectedMacedonian, wordOrderSelections
3. Add button after the exercises list (after the map) when quizCompleted is true:
   - Use a Card with motivational styling (bg-muted/30)
   - Show score: "You got X of Y correct"
   - "Retake Quiz" button with RotateCcw icon
4. Add i18n keys: `learn.exercises.quizComplete`, `learn.exercises.retakeQuiz`, `learn.exercises.scoreText`

Style the retake section to be clearly visible but not disruptive.
  </action>
  <verify>npm run type-check passes, completing all exercises shows retake option</verify>
  <done>ExerciseSection shows "Retake Quiz" button after completing all exercises with score display</done>
</task>

<task type="auto">
  <name>Task 2: Fix section stepper navigation for completed lessons</name>
  <files>components/learn/LessonPageContentV2.tsx</files>
  <action>
Allow free navigation when user has previously completed the lesson:
1. Add state to track if lesson was previously completed: `const wasPrevisouslyCompleted = userProgress?.progress === 100`
2. Update stepper button disabled logic (line 936):
   - FROM: `disabled={index > currentSectionIndex && !isCompleted}`
   - TO: `disabled={!wasPreviouslyCompleted && index > currentSectionIndex && !isCompleted}`
3. Update stepper button click handler (line 931-934):
   - FROM: `if (index <= currentSectionIndex || isCompleted)`
   - TO: `if (wasPreviouslyCompleted || index <= currentSectionIndex || isCompleted)`
4. Apply same logic to desktop tabs (lines 980-984)
5. Update cursor/opacity styling to reflect new enabled state

This allows users revisiting a completed lesson to jump to any section freely.
  </action>
  <verify>npm run type-check passes, revisiting completed lesson allows clicking any section</verify>
  <done>Section stepper allows free navigation when lesson was previously completed</done>
</task>

<task type="auto">
  <name>Task 3: Verify grammar examples expansion works correctly</name>
  <files>components/learn/GrammarSection.tsx</files>
  <action>
Audit the grammar examples expansion feature:
1. Review the "Show X more examples" button behavior (lines 128-151)
2. Verify expandedExamples state toggles correctly
3. Test that clicking "Show X more examples" reveals remaining examples
4. Test that "Show fewer" collapses back to 4 examples

If working correctly, document in commit message that feature was verified.
If issues found, fix the toggle logic. Common issues:
- State not persisting across re-renders
- Incorrect conditional rendering
- Button not triggering state update

The button should be responsive (min-h-[44px] tap target for mobile).
  </action>
  <verify>npm run type-check passes, grammar section with >4 examples shows expand/collapse correctly</verify>
  <done>Grammar examples expansion verified working or fixed if issues found</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] ExerciseSection shows retake button after completing all exercises
- [ ] Section stepper allows free navigation on previously completed lessons
- [ ] Grammar examples expand/collapse works correctly
</verification>

<success_criteria>
- Quiz retake functionality available after completing exercises
- Free section navigation for completed lessons
- Grammar expansion behavior verified/fixed
- All type checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/34-remaining-polish/34-02-SUMMARY.md`
</output>

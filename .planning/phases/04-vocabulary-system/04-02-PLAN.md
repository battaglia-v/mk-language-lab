---
phase: 04-vocabulary-system
plan: 02
type: execute
---

<objective>
Add user vocab action hooks and integrate with practice flow.

Purpose: Enable "Save word" and "Mark unknown" actions during practice sessions.
Output: useVocabulary hook with save/review actions connected to API.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-vocabulary-system/04-01-SUMMARY.md

# API endpoints from 04-01:
@app/api/user/vocabulary/route.ts
@app/api/user/vocabulary/[id]/route.ts

# Existing practice components:
@components/practice/usePracticeDecks.ts
@components/practice/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useVocabulary hook for vocab state management</name>
  <files>components/practice/useVocabulary.ts</files>
  <action>
Create React hook that manages vocabulary state:

```typescript
export function useVocabulary() {
  // State
  const [vocabulary, setVocabulary] = useState<VocabWord[]>([]);
  const [counts, setCounts] = useState<VocabCounts>({ new: 0, learning: 0, mastered: 0, due: 0, total: 0 });
  const [isLoading, setIsLoading] = useState(true);

  // Actions
  const loadVocabulary = async (status?: VocabStatus) => { ... }
  const saveWord = async (word: SaveWordInput) => { ... }
  const recordReview = async (wordId: string, correct: boolean) => { ... }
  const getDueWords = async () => { ... }

  return { vocabulary, counts, isLoading, loadVocabulary, saveWord, recordReview, getDueWords };
}
```

Types:
- VocabWord: { id, wordMk, wordEn, mastery, nextReviewAt, ... }
- VocabStatus: 'new' | 'learning' | 'mastered' | 'due' | 'all'
- VocabCounts: { new, learning, mastered, due, total }
- SaveWordInput: { wordMk, wordEn, phonetic?, source, sourceId? }

Hook should:
- Call GET /api/user/vocabulary on mount
- Provide saveWord that calls POST endpoint
- Provide recordReview that calls PATCH endpoint
- Update local state after mutations for optimistic UI
  </action>
  <verify>npm run type-check passes</verify>
  <done>useVocabulary hook provides vocab CRUD operations</done>
</task>

<task type="auto">
  <name>Task 2: Add vocab actions to practice session flow</name>
  <files>components/practice/usePracticeDecks.ts, lib/practice-session.ts</files>
  <action>
Integrate vocab actions into practice flow:

1. In usePracticeDecks.ts:
   - Import useVocabulary
   - Add 'user-vocab' deck type to getDeck()
   - Add loadUserVocabDeck() that fetches due + new words
   - Return vocab actions (saveWord, recordReview) for UI

2. Create/update practice session to record reviews:
   - When user answers correctly → recordReview(wordId, true)
   - When user answers incorrectly → recordReview(wordId, false)
   - Track which words came from user vocab vs curated

Note: Don't modify existing practice UI yet - just wire up the hooks.
Update types.ts to add 'user-vocab' to DeckType if not already present.
  </action>
  <verify>npm run type-check && npm run lint</verify>
  <done>Practice flow can record reviews to user vocabulary</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `npm run lint` passes
- [ ] useVocabulary hook exports all required functions
- [ ] usePracticeDecks integrates user-vocab deck type
</verification>

<success_criteria>

- useVocabulary hook created with CRUD operations
- Practice deck system supports user-vocab
- Review results saved to database via API
- No TypeScript or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-vocabulary-system/04-02-SUMMARY.md`
</output>

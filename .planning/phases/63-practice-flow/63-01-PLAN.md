---
phase: 63-practice-flow
plan: 01
type: execute
---

<objective>
Practice Hub UI and mobile practice API endpoint.

Purpose: Build the mode selection screen that launches practice sessions and the API to fetch practice vocabulary for mobile.
Output: Practice hub with mode cards, mobile practice API returning vocabulary from completed lessons.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/62-learn-flow/62-02-SUMMARY.md

# Key files from Phase 61/62:
@apps/mobile/lib/api.ts
@apps/mobile/lib/lesson.ts
@apps/mobile/app/(tabs)/practice.tsx

# Web practice patterns for reference:
@components/practice/PracticeHub.tsx
@app/api/practice/lesson-vocab/route.ts
@packages/practice/src/cards.ts

**Tech stack available:** expo-router, zustand, StyleSheet
**Established patterns:** API fetch with auth, tab navigation, section tabs

**From Phase 62:** Learn flow complete with lesson runner and section tabs.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile practice API endpoint</name>
  <files>app/api/mobile/practice/route.ts</files>
  <action>
Create GET /api/mobile/practice endpoint that returns practice vocabulary for mobile sessions.

Query params:
- `deck`: 'lesson-review' (from completed lessons) | 'curated' (starter deck)
- `mode`: 'multipleChoice' | 'typing' | 'cloze' (card type)
- `limit`: optional number (default 20)

Response structure:
```typescript
{
  items: Array<{
    id: string;
    macedonian: string;
    english: string;
    category?: string;
    lessonId?: string;
  }>;
  meta: {
    deckType: string;
    total: number;
  };
}
```

For 'lesson-review' deck: Query completed lessons from UserLessonProgress, fetch vocabulary from VocabularyItem.
For 'curated' deck: Return items from data/practice-vocabulary.json (already exists).

Use getMobileSessionFromRequest for auth. Add Cache-Control headers for curriculum data (5 min cache).
  </action>
  <verify>curl -H "Authorization: Bearer $TOKEN" "$API_BASE/api/mobile/practice?deck=curated&limit=10" returns JSON with items array</verify>
  <done>API returns practice vocabulary with proper auth check, both deck types work</done>
</task>

<task type="auto">
  <name>Task 2: Create practice lib for mobile</name>
  <files>apps/mobile/lib/practice.ts</files>
  <action>
Create practice types and API helper matching the mobile practice API.

Types:
```typescript
export type PracticeItem = {
  id: string;
  macedonian: string;
  english: string;
  category?: string;
  lessonId?: string;
};

export type PracticeDeck = 'lesson-review' | 'curated';
export type PracticeMode = 'multipleChoice' | 'typing' | 'cloze' | 'tapWords' | 'matching';

export type PracticeCard = {
  id: string;
  type: PracticeMode;
  prompt: string;
  answer: string;
  options?: string[];  // for multipleChoice
  item: PracticeItem;
};
```

Functions:
- `fetchPracticeItems(deck: PracticeDeck, limit?: number): Promise<PracticeItem[]>` - calls mobile practice API
- `createPracticeCard(item: PracticeItem, type: PracticeMode, allItems: PracticeItem[]): PracticeCard` - builds card with options
- `evaluateAnswer(card: PracticeCard, answer: string): { isCorrect: boolean; expected: string }` - checks answer
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Practice types and helpers exported, createPracticeCard generates distractors for multipleChoice</done>
</task>

<task type="auto">
  <name>Task 3: Build Practice Hub screen</name>
  <files>apps/mobile/app/(tabs)/practice.tsx</files>
  <action>
Replace placeholder with Practice Hub UI similar to web PracticeHub.tsx.

Components:
1. Header with "Practice" title and subtitle
2. Mode cards (3 modes for MVP):
   - **Lesson Review** (primary) - Practice vocabulary from completed lessons
   - **Word Sprint** - Quick flashcard session from curated deck
   - **All Vocabulary** - Full starter vocabulary deck

Each mode card shows:
- Icon (BookOpen, Zap, Library from lucide-react-native)
- Title and description
- Card count badge (from API or placeholder)
- Chevron indicator

On press â†’ navigate to practice session: `router.push('/practice/session?deck=lesson-review&mode=multipleChoice')`

Style with StyleSheet.create matching the dark theme (#06060b background, #f7f8fb text).
Use TouchableOpacity for cards with min 48px touch targets.

Add placeholder for "My Saved Words" section (empty state for now - feature comes later).
  </action>
  <verify>Expo app shows Practice Hub with 3 mode cards, tapping navigates to /practice/session</verify>
  <done>Practice Hub displays mode selection cards with proper styling and navigation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes in apps/mobile
- [ ] Mobile practice API returns vocabulary for both deck types
- [ ] Practice Hub screen renders with 3 mode cards
- [ ] Tapping a mode card navigates to practice session route
</verification>

<success_criteria>

- API endpoint created with auth and caching
- Practice types and helpers defined
- Practice Hub UI matches design patterns
- Navigation to session route works
</success_criteria>

<output>
After completion, create `.planning/phases/63-practice-flow/63-01-SUMMARY.md`
</output>

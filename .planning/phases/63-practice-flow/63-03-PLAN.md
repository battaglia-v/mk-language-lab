---
phase: 63-practice-flow
plan: 03
type: execute
---

<objective>
Practice session screen and results screen.

Purpose: Build the main practice session that displays cards in sequence and the results screen showing session stats.
Output: Working practice session with card progression and completion results.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/63-practice-flow/63-02-SUMMARY.md

# Card components:
@apps/mobile/components/practice/MultipleChoiceCard.tsx
@apps/mobile/components/practice/TypingCard.tsx

# Practice lib:
@apps/mobile/lib/practice.ts

# Web session patterns:
@components/practice/PracticeSession.tsx
@app/[locale]/practice/results/page.tsx

**Established patterns:** API fetch, session state management
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create practice session screen</name>
  <files>apps/mobile/app/practice/session.tsx</files>
  <action>
Build practice session screen that fetches cards and displays them in sequence.

URL params (via expo-router useLocalSearchParams):
- `deck`: 'lesson-review' | 'curated'
- `mode`: 'multipleChoice' | 'typing' | 'cloze' | 'tapWords' | 'matching'
- `count`: number (default 10)

Session state:
```typescript
type SessionState = {
  cards: PracticeCard[];
  currentIndex: number;
  correct: number;
  incorrect: number;
  startTime: number;
  answers: Array<{ cardId: string; isCorrect: boolean }>;
};
```

UI structure:
1. Header: Progress bar + "X / Y" counter + Close button
2. Card area: Render appropriate card component based on mode
3. Pass onAnswer callback to card → updates state → advances to next

On session complete:
- Calculate accuracy, time spent
- Navigate to results: `router.replace('/practice/results?correct=X&total=Y&time=Z')`

Loading state: Show skeleton while fetching practice items.
Error state: Show retry button if API fails.

Use fetchPracticeItems and createPracticeCard from lib/practice.ts.
Shuffle cards on load for variety.
  </action>
  <verify>Practice session loads cards, progress updates, navigates to results on complete</verify>
  <done>Session screen manages card progression and tracks answers</done>
</task>

<task type="auto">
  <name>Task 2: Create results screen</name>
  <files>apps/mobile/app/practice/results.tsx</files>
  <action>
Build results screen showing session performance.

URL params:
- `correct`: number of correct answers
- `total`: total cards
- `time`: session duration in seconds
- `deck`: deck type (for "Practice Again" button)

UI structure:
1. Big score display: "8/10" with percentage ring/circle
2. Stats row: Accuracy %, Time spent, Streak info
3. XP earned badge (calculate: 10 XP base + 5 per correct)
4. Action buttons:
   - "Practice Again" → back to session with same deck
   - "Back to Practice" → router.replace to /practice tab
   - "Continue Learning" → link to /learn tab

Celebrate good performance (>= 80%): Add confetti or star animation.
Use consistent dark theme styling.

Calculate and display:
- Accuracy = (correct / total) * 100
- Time formatted as "X:XX" or "Xm Xs"
  </action>
  <verify>Results screen shows stats, buttons navigate correctly</verify>
  <done>Results screen displays performance with action buttons</done>
</task>

<task type="auto">
  <name>Task 3: Add practice completion API sync</name>
  <files>apps/mobile/lib/practice.ts</files>
  <action>
Add function to sync practice completion to backend.

```typescript
export async function submitPracticeCompletion(data: {
  deckType: string;
  mode: string;
  correct: number;
  total: number;
  accuracy: number;
  xpEarned: number;
  durationMs: number;
}): Promise<void>
```

Call POST /api/mobile/practice-completions with payload.
Handle auth errors gracefully (don't block UI).

Update results screen to call this on mount.
For offline support: Queue failed submissions to localStorage, retry on next session (basic implementation - full queue comes in 63-04).
  </action>
  <verify>Practice completion syncs to backend API</verify>
  <done>Completion data sent to backend, errors handled gracefully</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes in apps/mobile
- [ ] Practice session loads, displays cards, tracks progress
- [ ] Results screen shows accurate stats
- [ ] Completion syncs to backend API
- [ ] Navigation between screens works correctly
</verification>

<success_criteria>

- Full practice session flow working end-to-end
- Results screen displays stats with action buttons
- Backend sync implemented
- Navigation between Hub → Session → Results → Hub works
</success_criteria>

<output>
After completion, create `.planning/phases/63-practice-flow/63-03-SUMMARY.md`
</output>
